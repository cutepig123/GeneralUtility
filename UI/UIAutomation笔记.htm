<html xmlns:v="urn:schemas-microsoft-com:vml"
xmlns:o="urn:schemas-microsoft-com:office:office"
xmlns:w="urn:schemas-microsoft-com:office:word"
xmlns:m="http://schemas.microsoft.com/office/2004/12/omml"
xmlns="http://www.w3.org/TR/REC-html40">

<head>
<meta http-equiv=Content-Type content="text/html; charset=gb2312">
<meta name=ProgId content=Word.Document>
<meta name=Generator content="Microsoft Word 12">
<meta name=Originator content="Microsoft Word 12">
<link rel=File-List href="UIAutomation笔记.files/filelist.xml">
<link rel=Edit-Time-Data href="UIAutomation笔记.files/editdata.mso">
<!--[if !mso]>
<style>
v\:* {behavior:url(#default#VML);}
o\:* {behavior:url(#default#VML);}
w\:* {behavior:url(#default#VML);}
.shape {behavior:url(#default#VML);}
</style>
<![endif]--><!--[if gte mso 9]><xml>
 <o:DocumentProperties>
  <o:Author>hjs</o:Author>
  <o:LastAuthor>JSHe</o:LastAuthor>
  <o:Revision>31</o:Revision>
  <o:TotalTime>308</o:TotalTime>
  <o:Created>2014-03-09T04:53:00Z</o:Created>
  <o:LastSaved>2014-03-09T10:01:00Z</o:LastSaved>
  <o:Pages>7</o:Pages>
  <o:Words>5648</o:Words>
  <o:Characters>32197</o:Characters>
  <o:Company>JSHe</o:Company>
  <o:Lines>268</o:Lines>
  <o:Paragraphs>75</o:Paragraphs>
  <o:CharactersWithSpaces>37770</o:CharactersWithSpaces>
  <o:Version>12.00</o:Version>
 </o:DocumentProperties>
</xml><![endif]-->
<link rel=dataStoreItem href="UIAutomation笔记.files/item0009.xml"
target="UIAutomation笔记.files/props0010.xml">
<link rel=themeData href="UIAutomation笔记.files/themedata.thmx">
<link rel=colorSchemeMapping href="UIAutomation笔记.files/colorschememapping.xml">
<!--[if gte mso 9]><xml>
 <w:WordDocument>
  <w:Zoom>140</w:Zoom>
  <w:TrackMoves>false</w:TrackMoves>
  <w:TrackFormatting/>
  <w:PunctuationKerning/>
  <w:DrawingGridVerticalSpacing>7.8 磅</w:DrawingGridVerticalSpacing>
  <w:DisplayHorizontalDrawingGridEvery>0</w:DisplayHorizontalDrawingGridEvery>
  <w:DisplayVerticalDrawingGridEvery>2</w:DisplayVerticalDrawingGridEvery>
  <w:ValidateAgainstSchemas/>
  <w:SaveIfXMLInvalid>false</w:SaveIfXMLInvalid>
  <w:IgnoreMixedContent>false</w:IgnoreMixedContent>
  <w:AlwaysShowPlaceholderText>false</w:AlwaysShowPlaceholderText>
  <w:DoNotPromoteQF/>
  <w:LidThemeOther>EN-US</w:LidThemeOther>
  <w:LidThemeAsian>ZH-CN</w:LidThemeAsian>
  <w:LidThemeComplexScript>X-NONE</w:LidThemeComplexScript>
  <w:Compatibility>
   <w:SpaceForUL/>
   <w:BalanceSingleByteDoubleByteWidth/>
   <w:DoNotLeaveBackslashAlone/>
   <w:ULTrailSpace/>
   <w:DoNotExpandShiftReturn/>
   <w:AdjustLineHeightInTable/>
   <w:BreakWrappedTables/>
   <w:SnapToGridInCell/>
   <w:WrapTextWithPunct/>
   <w:UseAsianBreakRules/>
   <w:DontGrowAutofit/>
   <w:SplitPgBreakAndParaMark/>
   <w:DontVertAlignCellWithSp/>
   <w:DontBreakConstrainedForcedTables/>
   <w:DontVertAlignInTxbx/>
   <w:Word11KerningPairs/>
   <w:CachedColBalance/>
   <w:UseFELayout/>
  </w:Compatibility>
  <w:BrowserLevel>MicrosoftInternetExplorer4</w:BrowserLevel>
  <m:mathPr>
   <m:mathFont m:val="Cambria Math"/>
   <m:brkBin m:val="before"/>
   <m:brkBinSub m:val="--"/>
   <m:smallFrac m:val="off"/>
   <m:dispDef/>
   <m:lMargin m:val="0"/>
   <m:rMargin m:val="0"/>
   <m:defJc m:val="centerGroup"/>
   <m:wrapIndent m:val="1440"/>
   <m:intLim m:val="subSup"/>
   <m:naryLim m:val="undOvr"/>
  </m:mathPr></w:WordDocument>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:LatentStyles DefLockedState="false" DefUnhideWhenUsed="true"
  DefSemiHidden="true" DefQFormat="false" DefPriority="99"
  LatentStyleCount="267">
  <w:LsdException Locked="false" Priority="0" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Normal"/>
  <w:LsdException Locked="false" Priority="9" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="heading 1"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 2"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 3"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 4"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 5"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 6"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 7"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 8"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 9"/>
  <w:LsdException Locked="false" Priority="39" QFormat="true" Name="toc 1"/>
  <w:LsdException Locked="false" Priority="39" QFormat="true" Name="toc 2"/>
  <w:LsdException Locked="false" Priority="39" QFormat="true" Name="toc 3"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 4"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 5"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 6"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 7"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 8"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 9"/>
  <w:LsdException Locked="false" Priority="35" QFormat="true" Name="caption"/>
  <w:LsdException Locked="false" Priority="10" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Title"/>
  <w:LsdException Locked="false" Priority="1" Name="Default Paragraph Font"/>
  <w:LsdException Locked="false" Priority="11" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Subtitle"/>
  <w:LsdException Locked="false" Priority="22" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Strong"/>
  <w:LsdException Locked="false" Priority="20" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Emphasis"/>
  <w:LsdException Locked="false" Priority="59" SemiHidden="false"
   UnhideWhenUsed="false" Name="Table Grid"/>
  <w:LsdException Locked="false" UnhideWhenUsed="false" Name="Placeholder Text"/>
  <w:LsdException Locked="false" Priority="1" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="No Spacing"/>
  <w:LsdException Locked="false" Priority="60" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Shading"/>
  <w:LsdException Locked="false" Priority="61" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light List"/>
  <w:LsdException Locked="false" Priority="62" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Grid"/>
  <w:LsdException Locked="false" Priority="63" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 1"/>
  <w:LsdException Locked="false" Priority="64" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 2"/>
  <w:LsdException Locked="false" Priority="65" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 1"/>
  <w:LsdException Locked="false" Priority="66" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 2"/>
  <w:LsdException Locked="false" Priority="67" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 1"/>
  <w:LsdException Locked="false" Priority="68" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 2"/>
  <w:LsdException Locked="false" Priority="69" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 3"/>
  <w:LsdException Locked="false" Priority="70" SemiHidden="false"
   UnhideWhenUsed="false" Name="Dark List"/>
  <w:LsdException Locked="false" Priority="71" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Shading"/>
  <w:LsdException Locked="false" Priority="72" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful List"/>
  <w:LsdException Locked="false" Priority="73" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Grid"/>
  <w:LsdException Locked="false" Priority="60" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Shading Accent 1"/>
  <w:LsdException Locked="false" Priority="61" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light List Accent 1"/>
  <w:LsdException Locked="false" Priority="62" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Grid Accent 1"/>
  <w:LsdException Locked="false" Priority="63" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 1 Accent 1"/>
  <w:LsdException Locked="false" Priority="64" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 2 Accent 1"/>
  <w:LsdException Locked="false" Priority="65" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 1 Accent 1"/>
  <w:LsdException Locked="false" UnhideWhenUsed="false" Name="Revision"/>
  <w:LsdException Locked="false" Priority="34" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="List Paragraph"/>
  <w:LsdException Locked="false" Priority="29" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Quote"/>
  <w:LsdException Locked="false" Priority="30" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Intense Quote"/>
  <w:LsdException Locked="false" Priority="66" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 2 Accent 1"/>
  <w:LsdException Locked="false" Priority="67" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 1 Accent 1"/>
  <w:LsdException Locked="false" Priority="68" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 2 Accent 1"/>
  <w:LsdException Locked="false" Priority="69" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 3 Accent 1"/>
  <w:LsdException Locked="false" Priority="70" SemiHidden="false"
   UnhideWhenUsed="false" Name="Dark List Accent 1"/>
  <w:LsdException Locked="false" Priority="71" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Shading Accent 1"/>
  <w:LsdException Locked="false" Priority="72" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful List Accent 1"/>
  <w:LsdException Locked="false" Priority="73" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Grid Accent 1"/>
  <w:LsdException Locked="false" Priority="60" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Shading Accent 2"/>
  <w:LsdException Locked="false" Priority="61" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light List Accent 2"/>
  <w:LsdException Locked="false" Priority="62" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Grid Accent 2"/>
  <w:LsdException Locked="false" Priority="63" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 1 Accent 2"/>
  <w:LsdException Locked="false" Priority="64" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 2 Accent 2"/>
  <w:LsdException Locked="false" Priority="65" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 1 Accent 2"/>
  <w:LsdException Locked="false" Priority="66" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 2 Accent 2"/>
  <w:LsdException Locked="false" Priority="67" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 1 Accent 2"/>
  <w:LsdException Locked="false" Priority="68" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 2 Accent 2"/>
  <w:LsdException Locked="false" Priority="69" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 3 Accent 2"/>
  <w:LsdException Locked="false" Priority="70" SemiHidden="false"
   UnhideWhenUsed="false" Name="Dark List Accent 2"/>
  <w:LsdException Locked="false" Priority="71" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Shading Accent 2"/>
  <w:LsdException Locked="false" Priority="72" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful List Accent 2"/>
  <w:LsdException Locked="false" Priority="73" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Grid Accent 2"/>
  <w:LsdException Locked="false" Priority="60" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Shading Accent 3"/>
  <w:LsdException Locked="false" Priority="61" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light List Accent 3"/>
  <w:LsdException Locked="false" Priority="62" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Grid Accent 3"/>
  <w:LsdException Locked="false" Priority="63" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 1 Accent 3"/>
  <w:LsdException Locked="false" Priority="64" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 2 Accent 3"/>
  <w:LsdException Locked="false" Priority="65" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 1 Accent 3"/>
  <w:LsdException Locked="false" Priority="66" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 2 Accent 3"/>
  <w:LsdException Locked="false" Priority="67" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 1 Accent 3"/>
  <w:LsdException Locked="false" Priority="68" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 2 Accent 3"/>
  <w:LsdException Locked="false" Priority="69" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 3 Accent 3"/>
  <w:LsdException Locked="false" Priority="70" SemiHidden="false"
   UnhideWhenUsed="false" Name="Dark List Accent 3"/>
  <w:LsdException Locked="false" Priority="71" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Shading Accent 3"/>
  <w:LsdException Locked="false" Priority="72" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful List Accent 3"/>
  <w:LsdException Locked="false" Priority="73" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Grid Accent 3"/>
  <w:LsdException Locked="false" Priority="60" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Shading Accent 4"/>
  <w:LsdException Locked="false" Priority="61" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light List Accent 4"/>
  <w:LsdException Locked="false" Priority="62" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Grid Accent 4"/>
  <w:LsdException Locked="false" Priority="63" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 1 Accent 4"/>
  <w:LsdException Locked="false" Priority="64" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 2 Accent 4"/>
  <w:LsdException Locked="false" Priority="65" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 1 Accent 4"/>
  <w:LsdException Locked="false" Priority="66" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 2 Accent 4"/>
  <w:LsdException Locked="false" Priority="67" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 1 Accent 4"/>
  <w:LsdException Locked="false" Priority="68" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 2 Accent 4"/>
  <w:LsdException Locked="false" Priority="69" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 3 Accent 4"/>
  <w:LsdException Locked="false" Priority="70" SemiHidden="false"
   UnhideWhenUsed="false" Name="Dark List Accent 4"/>
  <w:LsdException Locked="false" Priority="71" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Shading Accent 4"/>
  <w:LsdException Locked="false" Priority="72" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful List Accent 4"/>
  <w:LsdException Locked="false" Priority="73" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Grid Accent 4"/>
  <w:LsdException Locked="false" Priority="60" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Shading Accent 5"/>
  <w:LsdException Locked="false" Priority="61" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light List Accent 5"/>
  <w:LsdException Locked="false" Priority="62" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Grid Accent 5"/>
  <w:LsdException Locked="false" Priority="63" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 1 Accent 5"/>
  <w:LsdException Locked="false" Priority="64" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 2 Accent 5"/>
  <w:LsdException Locked="false" Priority="65" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 1 Accent 5"/>
  <w:LsdException Locked="false" Priority="66" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 2 Accent 5"/>
  <w:LsdException Locked="false" Priority="67" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 1 Accent 5"/>
  <w:LsdException Locked="false" Priority="68" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 2 Accent 5"/>
  <w:LsdException Locked="false" Priority="69" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 3 Accent 5"/>
  <w:LsdException Locked="false" Priority="70" SemiHidden="false"
   UnhideWhenUsed="false" Name="Dark List Accent 5"/>
  <w:LsdException Locked="false" Priority="71" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Shading Accent 5"/>
  <w:LsdException Locked="false" Priority="72" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful List Accent 5"/>
  <w:LsdException Locked="false" Priority="73" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Grid Accent 5"/>
  <w:LsdException Locked="false" Priority="60" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Shading Accent 6"/>
  <w:LsdException Locked="false" Priority="61" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light List Accent 6"/>
  <w:LsdException Locked="false" Priority="62" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Grid Accent 6"/>
  <w:LsdException Locked="false" Priority="63" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 1 Accent 6"/>
  <w:LsdException Locked="false" Priority="64" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 2 Accent 6"/>
  <w:LsdException Locked="false" Priority="65" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 1 Accent 6"/>
  <w:LsdException Locked="false" Priority="66" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 2 Accent 6"/>
  <w:LsdException Locked="false" Priority="67" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 1 Accent 6"/>
  <w:LsdException Locked="false" Priority="68" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 2 Accent 6"/>
  <w:LsdException Locked="false" Priority="69" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 3 Accent 6"/>
  <w:LsdException Locked="false" Priority="70" SemiHidden="false"
   UnhideWhenUsed="false" Name="Dark List Accent 6"/>
  <w:LsdException Locked="false" Priority="71" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Shading Accent 6"/>
  <w:LsdException Locked="false" Priority="72" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful List Accent 6"/>
  <w:LsdException Locked="false" Priority="73" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Grid Accent 6"/>
  <w:LsdException Locked="false" Priority="19" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Subtle Emphasis"/>
  <w:LsdException Locked="false" Priority="21" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Intense Emphasis"/>
  <w:LsdException Locked="false" Priority="31" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Subtle Reference"/>
  <w:LsdException Locked="false" Priority="32" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Intense Reference"/>
  <w:LsdException Locked="false" Priority="33" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Book Title"/>
  <w:LsdException Locked="false" Priority="37" Name="Bibliography"/>
  <w:LsdException Locked="false" Priority="39" QFormat="true" Name="TOC Heading"/>
 </w:LatentStyles>
</xml><![endif]-->
<link rel=plchdr href="UIAutomation笔记.files/plchdr.htm">
<style>
<!--
 /* Font Definitions */
 @font-face
	{font-family:Wingdings;
	panose-1:5 0 0 0 0 0 0 0 0 0;
	mso-font-charset:2;
	mso-generic-font-family:auto;
	mso-font-pitch:variable;
	mso-font-signature:0 268435456 0 0 -2147483648 0;}
@font-face
	{font-family:宋体;
	panose-1:2 1 6 0 3 1 1 1 1 1;
	mso-font-alt:SimSun;
	mso-font-charset:134;
	mso-generic-font-family:auto;
	mso-font-pitch:variable;
	mso-font-signature:3 680460288 22 0 262145 0;}
@font-face
	{font-family:"Cambria Math";
	panose-1:2 4 5 3 5 4 6 3 2 4;
	mso-font-charset:0;
	mso-generic-font-family:roman;
	mso-font-pitch:variable;
	mso-font-signature:-536870145 1107305727 0 0 415 0;}
@font-face
	{font-family:Cambria;
	panose-1:2 4 5 3 5 4 6 3 2 4;
	mso-font-charset:0;
	mso-generic-font-family:roman;
	mso-font-pitch:variable;
	mso-font-signature:-536870145 1073743103 0 0 415 0;}
@font-face
	{font-family:Calibri;
	panose-1:2 15 5 2 2 2 4 3 2 4;
	mso-font-charset:0;
	mso-generic-font-family:swiss;
	mso-font-pitch:variable;
	mso-font-signature:-520092929 1073786111 9 0 415 0;}
@font-face
	{font-family:"\@宋体";
	panose-1:2 1 6 0 3 1 1 1 1 1;
	mso-font-charset:134;
	mso-generic-font-family:auto;
	mso-font-pitch:variable;
	mso-font-signature:3 680460288 22 0 262145 0;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{mso-style-unhide:no;
	mso-style-qformat:yes;
	mso-style-parent:"";
	margin:0cm;
	margin-bottom:.0001pt;
	text-align:justify;
	text-justify:inter-ideograph;
	mso-pagination:none;
	font-size:10.5pt;
	mso-bidi-font-size:11.0pt;
	font-family:"Calibri","sans-serif";
	mso-ascii-font-family:Calibri;
	mso-ascii-theme-font:minor-latin;
	mso-fareast-font-family:宋体;
	mso-fareast-theme-font:minor-fareast;
	mso-hansi-font-family:Calibri;
	mso-hansi-theme-font:minor-latin;
	mso-bidi-font-family:"Times New Roman";
	mso-bidi-theme-font:minor-bidi;
	mso-font-kerning:1.0pt;}
h1
	{mso-style-priority:9;
	mso-style-unhide:no;
	mso-style-qformat:yes;
	mso-style-link:"标题 1 Char";
	mso-margin-top-alt:auto;
	margin-right:0cm;
	mso-margin-bottom-alt:auto;
	margin-left:0cm;
	mso-pagination:widow-orphan;
	mso-outline-level:1;
	font-size:24.0pt;
	font-family:宋体;
	mso-bidi-font-family:宋体;
	font-weight:bold;}
h3
	{mso-style-priority:9;
	mso-style-unhide:no;
	mso-style-qformat:yes;
	mso-style-link:"标题 3 Char";
	mso-margin-top-alt:auto;
	margin-right:0cm;
	mso-margin-bottom-alt:auto;
	margin-left:0cm;
	mso-pagination:widow-orphan;
	mso-outline-level:3;
	font-size:13.5pt;
	font-family:宋体;
	mso-bidi-font-family:宋体;
	font-weight:bold;}
p.MsoToc1, li.MsoToc1, div.MsoToc1
	{mso-style-update:auto;
	mso-style-priority:39;
	mso-style-qformat:yes;
	mso-style-next:正文;
	margin:0cm;
	margin-bottom:.0001pt;
	text-align:justify;
	text-justify:inter-ideograph;
	mso-pagination:none;
	font-size:10.5pt;
	mso-bidi-font-size:11.0pt;
	font-family:"Calibri","sans-serif";
	mso-ascii-font-family:Calibri;
	mso-ascii-theme-font:minor-latin;
	mso-fareast-font-family:宋体;
	mso-fareast-theme-font:minor-fareast;
	mso-hansi-font-family:Calibri;
	mso-hansi-theme-font:minor-latin;
	mso-bidi-font-family:"Times New Roman";
	mso-bidi-theme-font:minor-bidi;
	mso-font-kerning:1.0pt;}
p.MsoToc2, li.MsoToc2, div.MsoToc2
	{mso-style-update:auto;
	mso-style-noshow:yes;
	mso-style-priority:39;
	mso-style-qformat:yes;
	mso-style-next:正文;
	margin-top:0cm;
	margin-right:0cm;
	margin-bottom:5.0pt;
	margin-left:11.0pt;
	line-height:115%;
	mso-pagination:widow-orphan;
	font-size:11.0pt;
	font-family:"Calibri","sans-serif";
	mso-ascii-font-family:Calibri;
	mso-ascii-theme-font:minor-latin;
	mso-fareast-font-family:宋体;
	mso-fareast-theme-font:minor-fareast;
	mso-hansi-font-family:Calibri;
	mso-hansi-theme-font:minor-latin;
	mso-bidi-font-family:"Times New Roman";
	mso-bidi-theme-font:minor-bidi;}
p.MsoToc3, li.MsoToc3, div.MsoToc3
	{mso-style-update:auto;
	mso-style-priority:39;
	mso-style-qformat:yes;
	mso-style-next:正文;
	margin-top:0cm;
	margin-right:0cm;
	margin-bottom:0cm;
	margin-left:42.0pt;
	margin-bottom:.0001pt;
	mso-para-margin-top:0cm;
	mso-para-margin-right:0cm;
	mso-para-margin-bottom:0cm;
	mso-para-margin-left:4.0gd;
	mso-para-margin-bottom:.0001pt;
	text-align:justify;
	text-justify:inter-ideograph;
	mso-pagination:none;
	font-size:10.5pt;
	mso-bidi-font-size:11.0pt;
	font-family:"Calibri","sans-serif";
	mso-ascii-font-family:Calibri;
	mso-ascii-theme-font:minor-latin;
	mso-fareast-font-family:宋体;
	mso-fareast-theme-font:minor-fareast;
	mso-hansi-font-family:Calibri;
	mso-hansi-theme-font:minor-latin;
	mso-bidi-font-family:"Times New Roman";
	mso-bidi-theme-font:minor-bidi;
	mso-font-kerning:1.0pt;}
p.MsoHeader, li.MsoHeader, div.MsoHeader
	{mso-style-noshow:yes;
	mso-style-priority:99;
	mso-style-link:"页眉 Char";
	margin:0cm;
	margin-bottom:.0001pt;
	text-align:center;
	mso-pagination:none;
	tab-stops:center 207.65pt right 415.3pt;
	layout-grid-mode:char;
	border:none;
	mso-border-bottom-alt:solid windowtext .75pt;
	padding:0cm;
	mso-padding-alt:0cm 0cm 1.0pt 0cm;
	font-size:9.0pt;
	font-family:"Calibri","sans-serif";
	mso-ascii-font-family:Calibri;
	mso-ascii-theme-font:minor-latin;
	mso-fareast-font-family:宋体;
	mso-fareast-theme-font:minor-fareast;
	mso-hansi-font-family:Calibri;
	mso-hansi-theme-font:minor-latin;
	mso-bidi-font-family:"Times New Roman";
	mso-bidi-theme-font:minor-bidi;
	mso-font-kerning:1.0pt;}
p.MsoFooter, li.MsoFooter, div.MsoFooter
	{mso-style-noshow:yes;
	mso-style-priority:99;
	mso-style-link:"页脚 Char";
	margin:0cm;
	margin-bottom:.0001pt;
	mso-pagination:none;
	tab-stops:center 207.65pt right 415.3pt;
	layout-grid-mode:char;
	font-size:9.0pt;
	font-family:"Calibri","sans-serif";
	mso-ascii-font-family:Calibri;
	mso-ascii-theme-font:minor-latin;
	mso-fareast-font-family:宋体;
	mso-fareast-theme-font:minor-fareast;
	mso-hansi-font-family:Calibri;
	mso-hansi-theme-font:minor-latin;
	mso-bidi-font-family:"Times New Roman";
	mso-bidi-theme-font:minor-bidi;
	mso-font-kerning:1.0pt;}
a:link, span.MsoHyperlink
	{mso-style-priority:99;
	color:blue;
	text-decoration:underline;
	text-underline:single;}
a:visited, span.MsoHyperlinkFollowed
	{mso-style-noshow:yes;
	mso-style-priority:99;
	color:purple;
	mso-themecolor:followedhyperlink;
	text-decoration:underline;
	text-underline:single;}
p.MsoPlainText, li.MsoPlainText, div.MsoPlainText
	{mso-style-priority:99;
	mso-style-link:"纯文本 Char";
	margin:0cm;
	margin-bottom:.0001pt;
	text-align:justify;
	text-justify:inter-ideograph;
	mso-pagination:none;
	font-size:10.5pt;
	font-family:宋体;
	mso-hansi-font-family:"Courier New";
	mso-bidi-font-family:"Courier New";
	mso-font-kerning:1.0pt;}
p
	{mso-style-noshow:yes;
	mso-style-priority:99;
	mso-margin-top-alt:auto;
	margin-right:0cm;
	mso-margin-bottom-alt:auto;
	margin-left:0cm;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:宋体;
	mso-bidi-font-family:宋体;}
p.MsoAcetate, li.MsoAcetate, div.MsoAcetate
	{mso-style-noshow:yes;
	mso-style-priority:99;
	mso-style-link:"批注框文本 Char";
	margin:0cm;
	margin-bottom:.0001pt;
	text-align:justify;
	text-justify:inter-ideograph;
	mso-pagination:none;
	font-size:9.0pt;
	font-family:"Calibri","sans-serif";
	mso-ascii-font-family:Calibri;
	mso-ascii-theme-font:minor-latin;
	mso-fareast-font-family:宋体;
	mso-fareast-theme-font:minor-fareast;
	mso-hansi-font-family:Calibri;
	mso-hansi-theme-font:minor-latin;
	mso-bidi-font-family:"Times New Roman";
	mso-bidi-theme-font:minor-bidi;
	mso-font-kerning:1.0pt;}
p.MsoTocHeading, li.MsoTocHeading, div.MsoTocHeading
	{mso-style-noshow:yes;
	mso-style-priority:39;
	mso-style-qformat:yes;
	mso-style-parent:"标题 1";
	mso-style-next:正文;
	margin-top:24.0pt;
	margin-right:0cm;
	margin-bottom:0cm;
	margin-left:0cm;
	margin-bottom:.0001pt;
	line-height:115%;
	mso-pagination:widow-orphan lines-together;
	page-break-after:avoid;
	font-size:14.0pt;
	font-family:"Cambria","serif";
	mso-ascii-font-family:Cambria;
	mso-ascii-theme-font:major-latin;
	mso-fareast-font-family:宋体;
	mso-fareast-theme-font:major-fareast;
	mso-hansi-font-family:Cambria;
	mso-hansi-theme-font:major-latin;
	mso-bidi-font-family:"Times New Roman";
	mso-bidi-theme-font:major-bidi;
	color:#365F91;
	mso-themecolor:accent1;
	mso-themeshade:191;
	font-weight:bold;}
span.Char
	{mso-style-name:"纯文本 Char";
	mso-style-priority:99;
	mso-style-unhide:no;
	mso-style-locked:yes;
	mso-style-link:纯文本;
	mso-bidi-font-size:10.5pt;
	font-family:宋体;
	mso-ascii-font-family:宋体;
	mso-fareast-font-family:宋体;
	mso-hansi-font-family:"Courier New";
	mso-bidi-font-family:"Courier New";}
span.Char0
	{mso-style-name:"页眉 Char";
	mso-style-noshow:yes;
	mso-style-priority:99;
	mso-style-unhide:no;
	mso-style-locked:yes;
	mso-style-link:页眉;
	mso-ansi-font-size:9.0pt;
	mso-bidi-font-size:9.0pt;}
span.Char1
	{mso-style-name:"页脚 Char";
	mso-style-noshow:yes;
	mso-style-priority:99;
	mso-style-unhide:no;
	mso-style-locked:yes;
	mso-style-link:页脚;
	mso-ansi-font-size:9.0pt;
	mso-bidi-font-size:9.0pt;}
span.1Char
	{mso-style-name:"标题 1 Char";
	mso-style-priority:9;
	mso-style-unhide:no;
	mso-style-locked:yes;
	mso-style-link:"标题 1";
	mso-ansi-font-size:24.0pt;
	mso-bidi-font-size:24.0pt;
	font-family:宋体;
	mso-ascii-font-family:宋体;
	mso-fareast-font-family:宋体;
	mso-hansi-font-family:宋体;
	mso-bidi-font-family:宋体;
	mso-font-kerning:18.0pt;
	font-weight:bold;}
span.3Char
	{mso-style-name:"标题 3 Char";
	mso-style-priority:9;
	mso-style-unhide:no;
	mso-style-locked:yes;
	mso-style-link:"标题 3";
	mso-ansi-font-size:13.5pt;
	mso-bidi-font-size:13.5pt;
	font-family:宋体;
	mso-ascii-font-family:宋体;
	mso-fareast-font-family:宋体;
	mso-hansi-font-family:宋体;
	mso-bidi-font-family:宋体;
	mso-font-kerning:0pt;
	font-weight:bold;}
span.avatar
	{mso-style-name:avatar;
	mso-style-unhide:no;}
span.profile-usercard-hover
	{mso-style-name:profile-usercard-hover;
	mso-style-unhide:no;}
span.user-name
	{mso-style-name:user-name;
	mso-style-unhide:no;}
span.value
	{mso-style-name:value;
	mso-style-unhide:no;}
span.attribute-value
	{mso-style-name:attribute-value;
	mso-style-unhide:no;}
span.Char2
	{mso-style-name:"批注框文本 Char";
	mso-style-noshow:yes;
	mso-style-priority:99;
	mso-style-unhide:no;
	mso-style-locked:yes;
	mso-style-link:批注框文本;
	mso-ansi-font-size:9.0pt;
	mso-bidi-font-size:9.0pt;}
.MsoChpDefault
	{mso-style-type:export-only;
	mso-default-props:yes;
	mso-bidi-font-family:"Times New Roman";
	mso-bidi-theme-font:minor-bidi;}
 /* Page Definitions */
 @page
	{mso-page-border-surround-header:no;
	mso-page-border-surround-footer:no;
	mso-footnote-separator:url("UIAutomation笔记.files/header.htm") fs;
	mso-footnote-continuation-separator:url("UIAutomation笔记.files/header.htm") fcs;
	mso-endnote-separator:url("UIAutomation笔记.files/header.htm") es;
	mso-endnote-continuation-separator:url("UIAutomation笔记.files/header.htm") ecs;}
@page Section1
	{size:595.3pt 841.9pt;
	margin:72.0pt 87.65pt 72.0pt 87.65pt;
	mso-header-margin:42.55pt;
	mso-footer-margin:49.6pt;
	mso-paper-source:0;
	layout-grid:15.6pt;}
div.Section1
	{page:Section1;}
 /* List Definitions */
 @list l0
	{mso-list-id:184177460;
	mso-list-type:hybrid;
	mso-list-template-ids:-1852550896 67698703 67698713 67698715 67698703 67698713 67698715 67698703 67698713 67698715;}
@list l0:level1
	{mso-level-tab-stop:none;
	mso-level-number-position:left;
	margin-left:21.0pt;
	text-indent:-21.0pt;}
@list l1
	{mso-list-id:374819469;
	mso-list-template-ids:681474052;}
@list l1:level1
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:36.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Symbol;}
ol
	{margin-bottom:0cm;}
ul
	{margin-bottom:0cm;}
-->
</style>
<!--[if gte mso 10]>
<style>
 /* Style Definitions */
 table.MsoNormalTable
	{mso-style-name:普通表格;
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	mso-style-noshow:yes;
	mso-style-priority:99;
	mso-style-qformat:yes;
	mso-style-parent:"";
	mso-padding-alt:0cm 5.4pt 0cm 5.4pt;
	mso-para-margin:0cm;
	mso-para-margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.5pt;
	mso-bidi-font-size:11.0pt;
	font-family:"Calibri","sans-serif";
	mso-ascii-font-family:Calibri;
	mso-ascii-theme-font:minor-latin;
	mso-hansi-font-family:Calibri;
	mso-hansi-theme-font:minor-latin;
	mso-bidi-font-family:"Times New Roman";
	mso-bidi-theme-font:minor-bidi;
	mso-font-kerning:1.0pt;}
</style>
<![endif]--><!--[if gte mso 9]><xml>
 <o:shapedefaults v:ext="edit" spidmax="3074"/>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <o:shapelayout v:ext="edit">
  <o:idmap v:ext="edit" data="2"/>
 </o:shapelayout></xml><![endif]-->
</head>

<body lang=ZH-CN link=blue vlink=purple style='tab-interval:21.0pt;text-justify-trim:
punctuation'>

<div class=Section1 style='layout-grid:15.6pt'><w:Sdt SdtDocPart="t"
 DocPartType="Table of Contents" DocPartUnique="t" ID="1173124591">
 <p class=MsoTocHeading><span style='font-family:宋体;mso-ascii-font-family:Cambria;
 mso-ascii-theme-font:major-latin;mso-fareast-font-family:宋体;mso-fareast-theme-font:
 major-fareast;mso-hansi-font-family:Cambria;mso-hansi-theme-font:major-latin;
 mso-ansi-language:ZH-CN'>目录</span><span style='mso-ansi-language:ZH-CN'><w:sdtPr></w:sdtPr></span></p>
 <p class=MsoToc1 style='tab-stops:42.0pt right dotted 419.5pt'><!--[if supportFields]><span
 lang=EN-US><span style='mso-element:field-begin'></span><span
 style='mso-spacerun:yes'>&nbsp;</span>TOC \o &quot;1-3&quot; \h \z \u <span
 style='mso-element:field-separator'></span></span><![endif]--><span
 lang=EN-US><span class=MsoHyperlink><span style='mso-no-proof:yes'><a
 href="#_Toc382133132">1.<span style='color:windowtext;text-decoration:none;
 text-underline:none'><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
 lang=EN-US style='font-family:宋体;mso-ascii-font-family:Calibri;mso-ascii-theme-font:
 minor-latin;mso-fareast-font-family:宋体;mso-fareast-theme-font:minor-fareast;
 mso-hansi-font-family:Calibri;mso-hansi-theme-font:minor-latin'><span
 lang=EN-US>工具</span></span><span style='color:windowtext;display:none;
 mso-hide:screen;text-decoration:none;text-underline:none'><span
 style='mso-tab-count:1 dotted'>... </span></span><!--[if supportFields]><span
 style='color:windowtext;display:none;mso-hide:screen;text-decoration:none;
 text-underline:none'><span style='mso-element:field-begin'></span></span><span
 style='color:windowtext;display:none;mso-hide:screen;text-decoration:none;
 text-underline:none'> PAGEREF _Toc382133132 \h </span><span style='color:windowtext;
 display:none;mso-hide:screen;text-decoration:none;text-underline:none'><span
 style='mso-element:field-separator'></span></span><![endif]--><span
 style='color:windowtext;display:none;mso-hide:screen;text-decoration:none;
 text-underline:none'>1</span><span style='color:windowtext;display:none;
 mso-hide:screen;text-decoration:none;text-underline:none'><!--[if gte mso 9]><xml>
  <w:data>08D0C9EA79F9BACE118C8200AA004BA90B02000000080000000E0000005F0054006F0063003300380032003100330033003100330032000000</w:data>
 </xml><![endif]--></span><!--[if supportFields]><span style='color:windowtext;
 display:none;mso-hide:screen;text-decoration:none;text-underline:none'><span
 style='mso-element:field-end'></span></span><![endif]--></a></span></span><span
 style='mso-no-proof:yes'><o:p></o:p></span></span></p>
 <p class=MsoToc1 style='tab-stops:42.0pt right dotted 419.5pt'><span
 class=MsoHyperlink><span lang=EN-US style='mso-no-proof:yes'><a
 href="#_Toc382133133">2.<span style='color:windowtext;text-decoration:none;
 text-underline:none'><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
 lang=EN-US style='font-family:宋体;mso-ascii-font-family:Calibri;mso-ascii-theme-font:
 minor-latin;mso-fareast-font-family:宋体;mso-fareast-theme-font:minor-fareast;
 mso-hansi-font-family:Calibri;mso-hansi-theme-font:minor-latin'><span
 lang=EN-US>链接</span></span><span style='color:windowtext;display:none;
 mso-hide:screen;text-decoration:none;text-underline:none'><span
 style='mso-tab-count:1 dotted'>... </span></span><!--[if supportFields]><span
 style='color:windowtext;display:none;mso-hide:screen;text-decoration:none;
 text-underline:none'><span style='mso-element:field-begin'></span></span><span
 style='color:windowtext;display:none;mso-hide:screen;text-decoration:none;
 text-underline:none'> PAGEREF _Toc382133133 \h </span><span style='color:windowtext;
 display:none;mso-hide:screen;text-decoration:none;text-underline:none'><span
 style='mso-element:field-separator'></span></span><![endif]--><span
 style='color:windowtext;display:none;mso-hide:screen;text-decoration:none;
 text-underline:none'>1</span><span style='color:windowtext;display:none;
 mso-hide:screen;text-decoration:none;text-underline:none'><!--[if gte mso 9]><xml>
  <w:data>08D0C9EA79F9BACE118C8200AA004BA90B02000000080000000E0000005F0054006F0063003300380032003100330033003100330033000000</w:data>
 </xml><![endif]--></span><!--[if supportFields]><span style='color:windowtext;
 display:none;mso-hide:screen;text-decoration:none;text-underline:none'><span
 style='mso-element:field-end'></span></span><![endif]--></a></span></span><span
 lang=EN-US style='mso-no-proof:yes'><o:p></o:p></span></p>
 <p class=MsoToc1 style='tab-stops:42.0pt right dotted 419.5pt'><span
 class=MsoHyperlink><span lang=EN-US style='mso-no-proof:yes'><a
 href="#_Toc382133134">3.<span style='color:windowtext;text-decoration:none;
 text-underline:none'><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
 lang=EN-US style='font-family:宋体;mso-ascii-font-family:Calibri;mso-ascii-theme-font:
 minor-latin;mso-fareast-font-family:宋体;mso-fareast-theme-font:minor-fareast;
 mso-hansi-font-family:Calibri;mso-hansi-theme-font:minor-latin'><span
 lang=EN-US>文章</span></span><span style='color:windowtext;display:none;
 mso-hide:screen;text-decoration:none;text-underline:none'><span
 style='mso-tab-count:1 dotted'>... </span></span><!--[if supportFields]><span
 style='color:windowtext;display:none;mso-hide:screen;text-decoration:none;
 text-underline:none'><span style='mso-element:field-begin'></span></span><span
 style='color:windowtext;display:none;mso-hide:screen;text-decoration:none;
 text-underline:none'> PAGEREF _Toc382133134 \h </span><span style='color:windowtext;
 display:none;mso-hide:screen;text-decoration:none;text-underline:none'><span
 style='mso-element:field-separator'></span></span><![endif]--><span
 style='color:windowtext;display:none;mso-hide:screen;text-decoration:none;
 text-underline:none'>1</span><span style='color:windowtext;display:none;
 mso-hide:screen;text-decoration:none;text-underline:none'><!--[if gte mso 9]><xml>
  <w:data>08D0C9EA79F9BACE118C8200AA004BA90B02000000080000000E0000005F0054006F0063003300380032003100330033003100330034000000</w:data>
 </xml><![endif]--></span><!--[if supportFields]><span style='color:windowtext;
 display:none;mso-hide:screen;text-decoration:none;text-underline:none'><span
 style='mso-element:field-end'></span></span><![endif]--></a></span></span><span
 lang=EN-US style='mso-no-proof:yes'><o:p></o:p></span></p>
 <p class=MsoToc3 style='tab-stops:right dotted 419.5pt'><span
 class=MsoHyperlink><span lang=EN-US style='mso-no-proof:yes'><a
 href="#_Toc382133135"><b><span style='font-family:宋体;mso-bidi-font-family:
 宋体;mso-font-kerning:0pt'>A little UIA Q&amp;A </span></b><b><span lang=EN-US
 style='font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:0pt'><span
 lang=EN-US>一点UIA</span></span></b><b><span lang=EN-US style='font-family:宋体;
 mso-bidi-font-family:宋体;mso-font-kerning:0pt'><span lang=EN-US>的问题解答</span></span></b><span
 style='color:windowtext;display:none;mso-hide:screen;text-decoration:none;
 text-underline:none'><span style='mso-tab-count:1 dotted'>... </span></span><!--[if supportFields]><span
 style='color:windowtext;display:none;mso-hide:screen;text-decoration:none;
 text-underline:none'><span style='mso-element:field-begin'></span></span><span
 style='color:windowtext;display:none;mso-hide:screen;text-decoration:none;
 text-underline:none'> PAGEREF _Toc382133135 \h </span><span style='color:windowtext;
 display:none;mso-hide:screen;text-decoration:none;text-underline:none'><span
 style='mso-element:field-separator'></span></span><![endif]--><span
 style='color:windowtext;display:none;mso-hide:screen;text-decoration:none;
 text-underline:none'>1</span><span style='color:windowtext;display:none;
 mso-hide:screen;text-decoration:none;text-underline:none'><!--[if gte mso 9]><xml>
  <w:data>08D0C9EA79F9BACE118C8200AA004BA90B02000000080000000E0000005F0054006F0063003300380032003100330033003100330035000000</w:data>
 </xml><![endif]--></span><!--[if supportFields]><span style='color:windowtext;
 display:none;mso-hide:screen;text-decoration:none;text-underline:none'><span
 style='mso-element:field-end'></span></span><![endif]--></a></span></span><span
 lang=EN-US style='mso-no-proof:yes'><o:p></o:p></span></p>
 <p class=MsoToc1 style='tab-stops:right dotted 419.5pt'><span
 class=MsoHyperlink><span lang=EN-US style='mso-no-proof:yes'><a
 href="#_Toc382133136"><b><span style='font-family:宋体;mso-bidi-font-family:
 宋体;mso-font-kerning:18.0pt'>Building a cache</span></b><span style='color:
 windowtext;display:none;mso-hide:screen;text-decoration:none;text-underline:
 none'><span style='mso-tab-count:1 dotted'>. </span></span><!--[if supportFields]><span
 style='color:windowtext;display:none;mso-hide:screen;text-decoration:none;
 text-underline:none'><span style='mso-element:field-begin'></span></span><span
 style='color:windowtext;display:none;mso-hide:screen;text-decoration:none;
 text-underline:none'> PAGEREF _Toc382133136 \h </span><span style='color:windowtext;
 display:none;mso-hide:screen;text-decoration:none;text-underline:none'><span
 style='mso-element:field-separator'></span></span><![endif]--><span
 style='color:windowtext;display:none;mso-hide:screen;text-decoration:none;
 text-underline:none'>1</span><span style='color:windowtext;display:none;
 mso-hide:screen;text-decoration:none;text-underline:none'><!--[if gte mso 9]><xml>
  <w:data>08D0C9EA79F9BACE118C8200AA004BA90B02000000080000000E0000005F0054006F0063003300380032003100330033003100330036000000</w:data>
 </xml><![endif]--></span><!--[if supportFields]><span style='color:windowtext;
 display:none;mso-hide:screen;text-decoration:none;text-underline:none'><span
 style='mso-element:field-end'></span></span><![endif]--></a></span></span><span
 lang=EN-US style='mso-no-proof:yes'><o:p></o:p></span></p>
 <p class=MsoToc1 style='tab-stops:right dotted 419.5pt'><span
 class=MsoHyperlink><span lang=EN-US style='mso-no-proof:yes'><a
 href="#_Toc382133137"><b><span style='font-family:宋体;mso-bidi-font-family:
 宋体;mso-font-kerning:18.0pt'>Events</span></b><span style='color:windowtext;
 display:none;mso-hide:screen;text-decoration:none;text-underline:none'><span
 style='mso-tab-count:1 dotted'>. </span></span><!--[if supportFields]><span
 style='color:windowtext;display:none;mso-hide:screen;text-decoration:none;
 text-underline:none'><span style='mso-element:field-begin'></span></span><span
 style='color:windowtext;display:none;mso-hide:screen;text-decoration:none;
 text-underline:none'> PAGEREF _Toc382133137 \h </span><span style='color:windowtext;
 display:none;mso-hide:screen;text-decoration:none;text-underline:none'><span
 style='mso-element:field-separator'></span></span><![endif]--><span
 style='color:windowtext;display:none;mso-hide:screen;text-decoration:none;
 text-underline:none'>2</span><span style='color:windowtext;display:none;
 mso-hide:screen;text-decoration:none;text-underline:none'><!--[if gte mso 9]><xml>
  <w:data>08D0C9EA79F9BACE118C8200AA004BA90B02000000080000000E0000005F0054006F0063003300380032003100330033003100330037000000</w:data>
 </xml><![endif]--></span><!--[if supportFields]><span style='color:windowtext;
 display:none;mso-hide:screen;text-decoration:none;text-underline:none'><span
 style='mso-element:field-end'></span></span><![endif]--></a></span></span><span
 lang=EN-US style='mso-no-proof:yes'><o:p></o:p></span></p>
 <p class=MsoToc1 style='tab-stops:right dotted 419.5pt'><span
 class=MsoHyperlink><span lang=EN-US style='mso-no-proof:yes'><a
 href="#_Toc382133138"><b><span style='font-family:宋体;mso-bidi-font-family:
 宋体;mso-font-kerning:18.0pt'>A mix of perf and inaccessible UI</span></b><span
 style='color:windowtext;display:none;mso-hide:screen;text-decoration:none;
 text-underline:none'><span style='mso-tab-count:1 dotted'>. </span></span><!--[if supportFields]><span
 style='color:windowtext;display:none;mso-hide:screen;text-decoration:none;
 text-underline:none'><span style='mso-element:field-begin'></span></span><span
 style='color:windowtext;display:none;mso-hide:screen;text-decoration:none;
 text-underline:none'> PAGEREF _Toc382133138 \h </span><span style='color:windowtext;
 display:none;mso-hide:screen;text-decoration:none;text-underline:none'><span
 style='mso-element:field-separator'></span></span><![endif]--><span
 style='color:windowtext;display:none;mso-hide:screen;text-decoration:none;
 text-underline:none'>3</span><span style='color:windowtext;display:none;
 mso-hide:screen;text-decoration:none;text-underline:none'><!--[if gte mso 9]><xml>
  <w:data>08D0C9EA79F9BACE118C8200AA004BA90B02000000080000000E0000005F0054006F0063003300380032003100330033003100330038000000</w:data>
 </xml><![endif]--></span><!--[if supportFields]><span style='color:windowtext;
 display:none;mso-hide:screen;text-decoration:none;text-underline:none'><span
 style='mso-element:field-end'></span></span><![endif]--></a></span></span><span
 lang=EN-US style='mso-no-proof:yes'><o:p></o:p></span></p>
 <p class=MsoToc1 style='tab-stops:right dotted 419.5pt'><span
 class=MsoHyperlink><span lang=EN-US style='mso-no-proof:yes'><a
 href="#_Toc382133139"><b><span style='font-family:宋体;mso-bidi-font-family:
 宋体;mso-font-kerning:18.0pt'>Context Menus</span></b><span style='color:windowtext;
 display:none;mso-hide:screen;text-decoration:none;text-underline:none'><span
 style='mso-tab-count:1 dotted'>. </span></span><!--[if supportFields]><span
 style='color:windowtext;display:none;mso-hide:screen;text-decoration:none;
 text-underline:none'><span style='mso-element:field-begin'></span></span><span
 style='color:windowtext;display:none;mso-hide:screen;text-decoration:none;
 text-underline:none'> PAGEREF _Toc382133139 \h </span><span style='color:windowtext;
 display:none;mso-hide:screen;text-decoration:none;text-underline:none'><span
 style='mso-element:field-separator'></span></span><![endif]--><span
 style='color:windowtext;display:none;mso-hide:screen;text-decoration:none;
 text-underline:none'>5</span><span style='color:windowtext;display:none;
 mso-hide:screen;text-decoration:none;text-underline:none'><!--[if gte mso 9]><xml>
  <w:data>08D0C9EA79F9BACE118C8200AA004BA90B02000000080000000E0000005F0054006F0063003300380032003100330033003100330039000000</w:data>
 </xml><![endif]--></span><!--[if supportFields]><span style='color:windowtext;
 display:none;mso-hide:screen;text-decoration:none;text-underline:none'><span
 style='mso-element:field-end'></span></span><![endif]--></a></span></span><span
 lang=EN-US style='mso-no-proof:yes'><o:p></o:p></span></p>
 <p class=MsoToc1 style='tab-stops:right dotted 419.5pt'><span
 class=MsoHyperlink><span lang=EN-US style='mso-no-proof:yes'><a
 href="#_Toc382133140"><b><span style='font-family:宋体;mso-bidi-font-family:
 宋体;mso-font-kerning:18.0pt'>Caching and properties</span></b><span
 style='color:windowtext;display:none;mso-hide:screen;text-decoration:none;
 text-underline:none'><span style='mso-tab-count:1 dotted'>. </span></span><!--[if supportFields]><span
 style='color:windowtext;display:none;mso-hide:screen;text-decoration:none;
 text-underline:none'><span style='mso-element:field-begin'></span></span><span
 style='color:windowtext;display:none;mso-hide:screen;text-decoration:none;
 text-underline:none'> PAGEREF _Toc382133140 \h </span><span style='color:windowtext;
 display:none;mso-hide:screen;text-decoration:none;text-underline:none'><span
 style='mso-element:field-separator'></span></span><![endif]--><span
 style='color:windowtext;display:none;mso-hide:screen;text-decoration:none;
 text-underline:none'>5</span><span style='color:windowtext;display:none;
 mso-hide:screen;text-decoration:none;text-underline:none'><!--[if gte mso 9]><xml>
  <w:data>08D0C9EA79F9BACE118C8200AA004BA90B02000000080000000E0000005F0054006F0063003300380032003100330033003100340030000000</w:data>
 </xml><![endif]--></span><!--[if supportFields]><span style='color:windowtext;
 display:none;mso-hide:screen;text-decoration:none;text-underline:none'><span
 style='mso-element:field-end'></span></span><![endif]--></a></span></span><span
 lang=EN-US style='mso-no-proof:yes'><o:p></o:p></span></p>
 <p class=MsoToc1 style='tab-stops:right dotted 419.5pt'><span
 class=MsoHyperlink><span lang=EN-US style='mso-no-proof:yes'><a
 href="#_Toc382133141"><b><span style='font-family:宋体;mso-bidi-font-family:
 宋体;mso-font-kerning:18.0pt'>Timeouts interacting with unresponsive providers</span></b><span
 style='color:windowtext;display:none;mso-hide:screen;text-decoration:none;
 text-underline:none'><span style='mso-tab-count:1 dotted'>. </span></span><!--[if supportFields]><span
 style='color:windowtext;display:none;mso-hide:screen;text-decoration:none;
 text-underline:none'><span style='mso-element:field-begin'></span></span><span
 style='color:windowtext;display:none;mso-hide:screen;text-decoration:none;
 text-underline:none'> PAGEREF _Toc382133141 \h </span><span style='color:windowtext;
 display:none;mso-hide:screen;text-decoration:none;text-underline:none'><span
 style='mso-element:field-separator'></span></span><![endif]--><span
 style='color:windowtext;display:none;mso-hide:screen;text-decoration:none;
 text-underline:none'>6</span><span style='color:windowtext;display:none;
 mso-hide:screen;text-decoration:none;text-underline:none'><!--[if gte mso 9]><xml>
  <w:data>08D0C9EA79F9BACE118C8200AA004BA90B02000000080000000E0000005F0054006F0063003300380032003100330033003100340031000000</w:data>
 </xml><![endif]--></span><!--[if supportFields]><span style='color:windowtext;
 display:none;mso-hide:screen;text-decoration:none;text-underline:none'><span
 style='mso-element:field-end'></span></span><![endif]--></a></span></span><span
 lang=EN-US style='mso-no-proof:yes'><o:p></o:p></span></p>
 <p class=MsoNormal><!--[if supportFields]><span lang=EN-US><span
 style='mso-element:field-end'></span></span><![endif]--><span lang=EN-US><o:p>&nbsp;</o:p></span></p>
</w:Sdt>

<p class=MsoPlainText><span lang=EN-US style='mso-hansi-font-family:宋体;
mso-bidi-font-family:宋体'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText><span lang=EN-US style='mso-hansi-font-family:宋体;
mso-bidi-font-family:宋体'><o:p>&nbsp;</o:p></span></p>

<h1 style='margin-left:21.0pt;text-indent:-21.0pt;mso-list:l0 level1 lfo2'><a
name="_Toc382133132"><![if !supportLists]><span lang=EN-US><span
style='mso-list:Ignore'>1.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]>工具</a></h1>

<p class=MsoPlainText><span lang=EN-US style='mso-hansi-font-family:宋体;
mso-bidi-font-family:宋体'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText><span lang=EN-US style='mso-hansi-font-family:宋体;
mso-bidi-font-family:宋体'>C:\Program Files (x86)\Windows
Kits\8.1\bin\x64\UIAVerify\VisualUIAVerifyNative.exe<o:p></o:p></span></p>

<p class=MsoPlainText><span lang=EN-US style='mso-hansi-font-family:宋体;
mso-bidi-font-family:宋体'>G:\uitest_sw\uiautomationverify-94877\UIAVerify\visualuiaverify.sln<o:p></o:p></span></p>

<p class=MsoPlainText><span lang=EN-US style='mso-hansi-font-family:宋体;
mso-bidi-font-family:宋体'><o:p>&nbsp;</o:p></span></p>

<h1 style='margin-left:21.0pt;text-indent:-21.0pt;mso-list:l0 level1 lfo2'><a
name="_Toc382133133"><![if !supportLists]><span lang=EN-US><span
style='mso-list:Ignore'>2.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]>链接</a></h1>

<p class=MsoPlainText><span lang=EN-US style='mso-hansi-font-family:宋体;
mso-bidi-font-family:宋体'>http://blogs.msdn.com/b/winuiautomation/archive/2013/06/04/a-little-uia-q-amp-a.aspx<o:p></o:p></span></p>

<p class=MsoPlainText><span lang=EN-US style='mso-hansi-font-family:宋体;
mso-bidi-font-family:宋体'>G:\uitest_sw\UIAVerify2.0_x86\HowToUseUIAVerify.doc <o:p></o:p></span></p>

<h1 style='margin-left:21.0pt;text-indent:-21.0pt;mso-list:l0 level1 lfo2'><a
name="_Toc382133134"><![if !supportLists]><span lang=EN-US><span
style='mso-list:Ignore'>3.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]>文章</a></h1>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan;mso-outline-level:3'><a
name="_Toc382133135"><b><span lang=EN-US style='font-size:13.5pt;font-family:
宋体;mso-bidi-font-family:宋体;mso-font-kerning:0pt'>A little UIA Q&amp;A </span></b></a><span
style='mso-bookmark:_Toc382133135'><b><span style='font-size:13.5pt;font-family:
宋体;mso-bidi-font-family:宋体;mso-font-kerning:0pt'>一点<span lang=EN-US>UIA</span>的问题解答</span></b></span><b><span
lang=EN-US style='font-size:13.5pt;font-family:宋体;mso-bidi-font-family:宋体;
mso-font-kerning:0pt'><o:p></o:p></span></b></p>

<p class=MsoNormal align=left style='text-align:left;mso-pagination:widow-orphan'><span
lang=EN-US><a href="http://blogs.msdn.com/352656/ProfileUrlRedirect.ashx"><span
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt;mso-no-proof:yes;text-decoration:none;text-underline:none'><!--[if gte vml 1]><v:shapetype
 id="_x0000_t75" coordsize="21600,21600" o:spt="75" o:preferrelative="t"
 path="m@4@5l@4@11@9@11@9@5xe" filled="f" stroked="f">
 <v:stroke joinstyle="miter"/>
 <v:formulas>
  <v:f eqn="if lineDrawn pixelLineWidth 0"/>
  <v:f eqn="sum @0 1 0"/>
  <v:f eqn="sum 0 0 @1"/>
  <v:f eqn="prod @2 1 2"/>
  <v:f eqn="prod @3 21600 pixelWidth"/>
  <v:f eqn="prod @3 21600 pixelHeight"/>
  <v:f eqn="sum @0 0 1"/>
  <v:f eqn="prod @6 1 2"/>
  <v:f eqn="prod @7 21600 pixelWidth"/>
  <v:f eqn="sum @8 21600 0"/>
  <v:f eqn="prod @7 21600 pixelHeight"/>
  <v:f eqn="sum @10 21600 0"/>
 </v:formulas>
 <v:path o:extrusionok="f" gradientshapeok="t" o:connecttype="rect"/>
 <o:lock v:ext="edit" aspectratio="t"/>
</v:shapetype><v:shape id="图片_x0020_1" o:spid="_x0000_i1025" type="#_x0000_t75"
 alt="http://i1.social.microsoft.com/profile/u/avatar.jpg?displayname=guy+barker+msft&amp;size=large"
 href="http://blogs.msdn.com/352656/ProfileUrlRedirect.ashx" style='width:33pt;
 height:33pt;visibility:visible;mso-wrap-style:square' o:button="t">
 <v:imagedata src="UIAutomation笔记.files/image001.jpg" o:title="avatar"/>
</v:shape><![endif]--><![if !vml]><span style='mso-ignore:vglayout'><img
border=0 width=44 height=44 src="UIAutomation笔记.files/image001.jpg"
alt="http://i1.social.microsoft.com/profile/u/avatar.jpg?displayname=guy+barker+msft&amp;size=large"
v:shapes="图片_x0020_1"></span><![endif]></span></a></span><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'><a href="http://blogs.msdn.com/352656/ProfileUrlRedirect.ashx">Guy Barker
MSFT</a> <o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-pagination:widow-orphan'><span
lang=EN-US style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;
mso-font-kerning:0pt'>4 Jun 2013 6:37 AM <o:p></o:p></span></p>

<ul type=disc>
 <li class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
     text-align:left;mso-pagination:widow-orphan;mso-list:l1 level1 lfo1;
     tab-stops:list 36.0pt'><span lang=EN-US style='font-size:12.0pt;
     font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:0pt'><a
     href="http://blogs.msdn.com/b/winuiautomation/archive/2013/06/04/a-little-uia-q-amp-a.aspx#comments">5</a>
     <o:p></o:p></span></li>
</ul>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>Hi, over the last six months I’ve been in contact with a developer who
builds Assistive Technology (AT)&nbsp;apps which use the Windows 8 UI
Automation (UIA) client API. It’s been really exciting for me to see the
results of his great work, as those results will be extremely helpful to his
customers. It’s also been very interesting for me to see him focus so much on
the performance of his app, as that’s an area where UIA’s caching functionality
can be a big help.<o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span style='font-size:12.0pt;
font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:0pt'>最近六个月我和一位使用<span
lang=EN-US>UIA client api</span>开发<span lang=EN-US>at apps</span>的<span
lang=EN-US>developer</span>联系。看到她的成果我很兴奋。他很关注她的<span lang=EN-US>app</span>的性能，这方面<span
lang=EN-US>uia</span>的<span lang=EN-US>caching</span>功能很有用<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>Given that some of the discussions we’ve had during this time might be of
interest to others building&nbsp;AT apps with UIA, with the dev’s permissions
I’ve included some of the more general interaction below.<o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:Symbol;mso-ascii-font-family:宋体;mso-fareast-font-family:
宋体;mso-hansi-font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:0pt;
mso-char-type:symbol;mso-symbol-font-family:Symbol'><span style='mso-char-type:
symbol;mso-symbol-font-family:Symbol'>J</span></span><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>I hope this can help others build lots of exciting UIA client apps too! <o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>Guy<o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>&nbsp;<o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan;mso-outline-level:1'><a
name="_Toc382133136"><b><span lang=EN-US style='font-size:24.0pt;font-family:
宋体;mso-bidi-font-family:宋体;mso-font-kerning:18.0pt'>Building a cache</span></b></a><span
style='mso-bookmark:_Toc382133136'></span><b><span style='font-size:24.0pt;
font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:18.0pt'>建立<span
lang=EN-US>cache<o:p></o:p></span></span></b></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><b><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>Q.</span></b><span lang=EN-US style='font-size:12.0pt;font-family:宋体;
mso-bidi-font-family:宋体;mso-font-kerning:0pt'> I'm using the unmanaged COM API
and building an element array using FindAllBuildCache.&nbsp;I trigger the build
whenever the active window changes using SetWindowEventHook implemented in
C#.&nbsp; It works well but builds the element array immediately the new window
takes focus, I've been using a delay before the build of the elements array to
make sure everything is painted on the window but was trying to find a more
reliable window loaded type of event.&nbsp; Just wonder what technique you
would recommend to do this?&nbsp; So as an example if Windows Explorer becomes
the new active window how do I ensure all the UI elements are loaded before
building my element array?<o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>&nbsp;</span><span style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:
宋体;mso-font-kerning:0pt'>我用<span lang=EN-US>unmanaged COM API</span>，使用<span
lang=EN-US>FindAllBuildCache</span>建立了一个<span lang=EN-US>element array</span>。我用<span
lang=EN-US>SetWindowEventHook</span>来实现每当<span lang=EN-US>active window</span>改变就触发新的<span
lang=EN-US>build</span>。他工作很好，但是很慢。我想找到一种更<span lang=EN-US>reliable</span>的事件。有什么方法？比如如果<span
lang=EN-US>Windows Explorer</span>变成新的<span lang=EN-US>active window</span>时，我怎样才能保证所有的<span
lang=EN-US>UI elements</span>已经在我<span lang=EN-US>building my element array</span>之前装载？<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><b><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>A.</span></b><span lang=EN-US style='font-size:12.0pt;font-family:宋体;
mso-bidi-font-family:宋体;mso-font-kerning:0pt'> I would say that it's good that
you're using the COM UIA API, rather than the managed API that comes with the
.NET Framework. The latter can be handy in some situations, (particularly for
devs who aren't familiar with COM), but it can't access some of the data that
is accessible through the COM API. It's also good that you're using UIA's
caching, given that caching provides a better performance. <o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span style='font-size:12.0pt;
font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:0pt'>你使用<span
lang=EN-US>COM UIA API</span>而不是<span lang=EN-US>managed API</span>这很好。后者在某些情况下很好，但某些数据不能如<span
lang=EN-US>COM API</span>一样获取。你在用<span lang=EN-US>UIA's caching</span>也很好，因为它能提供更好的性能<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>The thing that complicates your scenario is that different features will
behave differently. They'll present all sorts of different UI, and will use
different UI frameworks, eg Win32, WinForms, WPF, and Windows Store apps add
more to the mix. There's no single event that you can react to which will
indicate that all the UI you're interested in is now on the screen. Browsers
will make this even more complicated, because when you navigate to a different
page or place on a page in a browser, you might only get a bunch of UI
restructuring for the hosted HTML, and no window-related events.<o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>In this situation, I find it interesting to use the AccEvent tool that
comes with the Windows SDK. It's not very intuitive to use, but it can be
helpful. It can be set up to report UIA events coming from all UI, or just from
a particular window. So as a test, I pointed it to an existing (but minimized)
Windows Explorer window, and then restored the window such that it was the
active window. (AccEvent has no Select All and Clear All when picking which
events you want to listen for, which is frustrating.)<o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span style='font-size:12.0pt;
font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:0pt'>我发现使用<span
lang=EN-US>AccEvent tool</span>很有用。比如我选择了一个已有的<span lang=EN-US>Windows Explorer</span>窗口，然后<span
lang=EN-US>restore</span>他，以下是输出：<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>This was the output:&nbsp;<o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;color:#333399;
mso-font-kerning:0pt'>UIA:PropertyEvent [Name = &quot;Address: Computer&quot;]
Sender: ControlType:UIA_ToolBarControlTypeId (0xC365), Name:&quot;Address:
Computer&quot;</span><span lang=EN-US style='font-size:12.0pt;font-family:宋体;
mso-bidi-font-family:宋体;mso-font-kerning:0pt'><o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;color:#333399;
mso-font-kerning:0pt'>UIA:StructureEvent
[StructureChangeType_ChildrenInvalidated = TBI&lt;rtid&gt;] Sender:
ControlType:UIA_ProgressBarControlTypeId (0xC35C), Name:&quot;&quot;</span><span
lang=EN-US style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;
mso-font-kerning:0pt'><o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;color:#333399;
mso-font-kerning:0pt'>UIA:StructureEvent
[StructureChangeType_ChildrenInvalidated = TBI&lt;rtid&gt;] Sender:
ControlType:UIA_ProgressBarControlTypeId (0xC35C), Name:&quot;&quot;</span><span
lang=EN-US style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;
mso-font-kerning:0pt'><o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;color:black;
mso-font-kerning:0pt'>(I've removed lots of structure changed events and
bounding rect changed events here…)</span><span lang=EN-US style='font-size:
12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:0pt'><o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;color:#333399;
mso-font-kerning:0pt'>UIA:PropertyEvent [BoundingRectangle = {l:141 t:682
r:1119 b:1091}] Sender: ControlType:UIA_WindowControlTypeId (0xC370),
Name:&quot;Computer&quot;</span><span lang=EN-US style='font-size:12.0pt;
font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:0pt'><o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;color:#333399;
mso-font-kerning:0pt'>UIA:FocusEvent Sender:
ControlType:UIA_ListItemControlTypeId (0xC357), Name:&quot;OS (C:)&quot;</span><span
lang=EN-US style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;
mso-font-kerning:0pt'><o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>&nbsp;<o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>So in this case, the Window Explorer window raised lots of events relating
to its contents being restructured and moving around, (which is what you'd
expect when the window's unminimized,) and followed all that with a single
focus changed event. There's no event after that saying the window UI has
stabilized, and there's no guarantee that at the actual point you get the focus
changed event, a feature has really completed the redisplay of its UI. When I
tried a similar thing in Internet Explorer, I again got lots of structure
changed and bounding rect changed events, with a focus changed event near the
end of the list. (I also got events for the text changing in a search field,
and a selection changing on the browsers tabs, but that doesn't help us here.)<o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>There are a couple of documented UIA events that sound like they may be of
interest, (ie UIA_LayoutInvalidatedEventId and UIA_AsyncContentLoadedEventId),
but in practice these aren't often raised, so aren't useful to you.<o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>So all in all, I don't think there's much more you can do than use the
delay you already have. If it's very quick to gather the data you need, perhaps
you could reduce the delay if it feels too long, and if you find you get more
structured changed and bounding rect changed events after you've gathered the
data, gather it all up again to account for the changes and re-present it.<o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>&nbsp;</span><span style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:
宋体;mso-font-kerning:0pt'>总之，我觉得除了使用<span lang=EN-US>delay</span>没有什么可以再做了。如果很快就能拿到你要的东西，你可以减少<span
lang=EN-US>delay</span>。如果你在拿到数据之后又收到了<span lang=EN-US>structured changed and
bounding rect changed</span>事件，把它重新拿一次<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><b><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>Q.</span></b><span lang=EN-US style='font-size:12.0pt;font-family:宋体;
mso-bidi-font-family:宋体;mso-font-kerning:0pt'> I used the COM API because I was
having speed issues with the managed API although some of it may have been down
to threading in the early days of playing with the API.&nbsp; I am building the
cache on change of active window again for speed issues so that when the user
command is called I can display the UI pretty instantly.&nbsp; If I don't build
the cache until the user command event then it can, for example with Internet
Explorer, take a couple of seconds to respond although with most UIs is pretty
instant.&nbsp;<o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>You mentioned updating the Cache on bounding rectangle changes and the
likes and I notice there is a BuildUpdatedCache method which you need to run on
each element.&nbsp; So if with my elements array I wanted to update my
cacheRequest then I have to iterate through the array and update each element
presuming it still exists on the window?&nbsp; I can’t quite work that one out
so I have basically just been running FindAllBuildCache on the various window
changing events.&nbsp;<o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>&nbsp;</span><span style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:
宋体;mso-font-kerning:0pt'>我是用<span lang=EN-US>COM API</span>是因为他快。为了速度，一旦<span
lang=EN-US>active window</span>改变我就<span lang=EN-US>building the cache</span>，这样才能一大用户<span
lang=EN-US>command</span>被调用，我就可以立刻更新<span lang=EN-US>ui</span>。<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span style='font-size:12.0pt;
font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:0pt'>你说过当<span
lang=EN-US>ounding rectangle</span>改变就更新<span lang=EN-US>cache</span>，我发现有一个<span
lang=EN-US>BuildUpdatedCache</span>方法，这个方法需要在每一个<span lang=EN-US>element</span>上执行。<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><b><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>A.</span></b><span lang=EN-US style='font-size:12.0pt;font-family:宋体;
mso-bidi-font-family:宋体;mso-font-kerning:0pt'> Hi, as it happens, It don’t
think I’ve ever called BuildUpdatedCache(). I wasn’t avoiding it, but I think
whenever I wanted to refresh the data which I was presenting to the user, I
called FindAllBuildCache() again, as you’re doing. In the case of an array of
elements as you have, I’ll bet that’s definitely the best thing to do. When it
comes to performance in things like this, it’s all about avoiding cross-process
calls. So if you can make a call which involves (say) one cross-proc call,
gathers a load of data once it’s in the other process, and then returns ,
that’s going to be a lot faster than making a load of cross-proc calls which
gather some data in each call. BuildUpdatedCache() is going to involve at least
one cross-proc call each time, so if you call it for each element in an array,
that’ll be slow. Calling FindAllBuildCache() will make far fewer cross-proc
calls, (sometimes only one.) So I would imagine BuildUpdatedCache()&nbsp; is
handy when you’re interested in a particular element. (By the way, if you’re
making repeated calls to FindAllBuildCache(), you’ll want to release objects
from earlier calls that you’re finished with. I seem to remember it not being
obvious as to when some of these objects would be released by UIA and when you
needed to explicitly release them, but my samples will demonstrate what I
thought was the required action.)<o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>&nbsp;</span><span style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:
宋体;mso-font-kerning:0pt'>我觉得<span lang=EN-US>FindAllBuildCache</span>更好，不想有过多的<span
lang=EN-US>cross-process calls<o:p></o:p></span></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan;mso-outline-level:1'><a
name="_Toc382133137"><b><span lang=EN-US style='font-size:24.0pt;font-family:
宋体;mso-bidi-font-family:宋体;mso-font-kerning:18.0pt'>Events</span></b></a><b><span
lang=EN-US style='font-size:24.0pt;font-family:宋体;mso-bidi-font-family:宋体;
mso-font-kerning:18.0pt'><o:p></o:p></span></b></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><b><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>Q.</span></b><span lang=EN-US style='font-size:12.0pt;font-family:宋体;
mso-bidi-font-family:宋体;mso-font-kerning:0pt'> I am trying to implement a
bounding rectangle property changed event for any of the descendant elements on
a relevant window, e.g. Internet Explorer.&nbsp; If I build my cache using
TreeScope.Descendants I can display my rectangles as shown below.&nbsp; I am then
trying to handle a bounding rectangle property changed event for any of the
descendants and seem to be getting sporadic results of when it is triggered
when it is not.&nbsp; Forgetting about threading for now, code is something
like this, should this record a change to any of the bounding rectangles of the
descendants are am I, as is most likely the case, not implementing
correctly?&nbsp;<o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>The &quot;activeWindow&quot; is just the element for the current active
window, in this case:<o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>Internet Explorer (activeWindow = uia.ElementFromHandleBuildCache(Win32API.GetForegroundWindow(),
myCache);<o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>&nbsp;&nbsp;</span><span style='font-size:12.0pt;font-family:宋体;
mso-bidi-font-family:宋体;mso-font-kerning:0pt'>我想实现一个<span lang=EN-US>bounding
rectangle property changed</span>事件<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;color:navy;
mso-font-kerning:0pt'>int [] propArray =
{UIA_PropertyIds.UIA_BoundingRectanglePropertyId};</span><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'><o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;color:navy;
mso-font-kerning:0pt'>uia.AddPropertyChangedEventHandler(activeWindow,
TreeScope.TreeScope_Descendants,</span><span lang=EN-US style='font-size:12.0pt;
font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:0pt'><o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;color:navy;
mso-font-kerning:0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; myCache, new
PropertyChangedEventHandler(activeWindow, win), propArray);</span><span
lang=EN-US style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;
mso-font-kerning:0pt'><o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;color:navy;
mso-font-kerning:0pt'>…</span><span lang=EN-US style='font-size:12.0pt;
font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:0pt'><o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;color:navy;
mso-font-kerning:0pt'>class PropertyChangedEventHandler :
IUIAutomationPropertyChangedEventHandler</span><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'><br>
<span style='color:navy'>{</span><br>
<span style='color:navy'>&nbsp;&nbsp;&nbsp; numberedWindow myWindow;</span><o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;color:navy;
mso-font-kerning:0pt'>&nbsp;&nbsp;&nbsp; public
PropertyChangedEventHandler(IUIAutomationElement sender, numberedWindow win)</span><span
lang=EN-US style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;
mso-font-kerning:0pt'><br>
<span style='color:navy'>&nbsp;&nbsp;&nbsp; {</span><br>
<span style='color:navy'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; myWindow =
win;</span><br>
<span style='color:navy'>&nbsp;&nbsp;&nbsp; }</span><o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;color:navy;
mso-font-kerning:0pt'>&nbsp;&nbsp;&nbsp; public void
HandlePropertyChangedEvent(IUIAutomationElement elem, int propertyID, object
obj)</span><span lang=EN-US style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:
宋体;mso-font-kerning:0pt'><br>
<span style='color:navy'>&nbsp;&nbsp;&nbsp; {</span><br>
<span style='color:navy'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if
(propertyID == UIA_PropertyIds.UIA_BoundingRectanglePropertyId)</span><br>
<span style='color:navy'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
MessageBox.Show(&quot;Property changed&quot;, &quot;&quot;, MessageBoxButton.OK,
MessageBoxImage.Error);</span><br>
<span style='color:navy'>&nbsp;&nbsp;&nbsp; }</span><br>
<span style='color:navy'>}</span><o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>&nbsp;<o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>When I say behaving sporadically, as an example if I zoomed in on the
window below the event would be triggered but with other webpages it isn't and
if I scroll down the page it isn't.&nbsp; I am presuming if I scroll down the
page that the bounding rectangle property should change.&nbsp; I basically
think the problem is that the event is not being fired for all the bounding
rectangle changes of the descendants.<o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>&nbsp;<o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><b><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>A.</span></b><span lang=EN-US style='font-size:12.0pt;font-family:宋体;
mso-bidi-font-family:宋体;mso-font-kerning:0pt'> I wouldn't assume there's
anything not correct in your implementation. The Windows UIA API is a powerful
tool, but every now and again some unexpected behavior is unearthed. It's
always possible that UIA has some issue, and all we can do is try to find a
workaround.<o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span style='font-size:12.0pt;
font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:0pt'>你的代码里没啥问题，有可能<span
lang=EN-US>uia</span>有问题<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>In the case you've described, it is interesting that it seems that
sometimes you get the events and sometimes you don't. As you point out, one
very relevant question is whether it's possible that the UI isn't firing the
events you'd expect. The first thing I do in this situation is run the AccEvent
SDK tool. That tool takes some getting used to, but it can be really helpful.
If you have the Windows SDK on your machine, you'll have accevent.exe
somewhere.<o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span style='font-size:12.0pt;
font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:0pt'>首先我建议运行<span
lang=EN-US>AccEvent</span>工具<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>If you run that tool, go to the Mode menu and verify that the &quot;UIA
events&quot; item is checked. (We're only ever interested in UIA events now.)
Then click to the Settings item and see the AccEvent settings. In the
&quot;Event Type&quot; list clear everything but the &quot;Bounding
Rectangle&quot; property changed event. (There's no Clear All and Select All button
here, so changing the options can be a real pain.) Then in the
&quot;Scope&quot; list, click the top level browser window, (assuming the
browser's already running.) Then in the &quot;Report properties&quot; list,
have a small number of useful things selected, (such and Name, Control Type and
BoundingRectangle.) Then click OK. Once back in the main AccEvent UI, go to the
Events menu, and click &quot;Start Listening&quot;.<o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span style='font-size:12.0pt;
font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:0pt'>进入<span
lang=EN-US>mode</span>菜单，确认<span lang=EN-US>uia events</span>选中。进入<span
lang=EN-US>setting</span>，在<span lang=EN-US>&quot;Event Type&quot;</span>清除掉除了<span
lang=EN-US>&quot;Bounding Rectangle&quot;</span>之外的所有事件，在<span lang=EN-US>&quot;Scope&quot;</span>选<span
lang=EN-US>top level browser window</span>，在<span lang=EN-US>&quot;Report
properties&quot;</span>选中一些属性<span lang=EN-US>(such and Name, Control Type and BoundingRectangle.)</span>，回去点击<span
lang=EN-US>&quot;Start Listening&quot;<o:p></o:p></span></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>AccEvent will now listen for UIA events, and report what it gets. It
doesn't using caching, (ie it'll go back to the source process to get the
properties of the element,) but it's pretty reliable. If it doesn't report some
events, I always take that to mean the events aren't being raised. I just tried
this with IE, and when a page was loaded, I saw some BoundingRectangle property
changed events. However, when I scroll down, I see no events raised. On another
page however, I did see some events generated when I scroll. (Actually, I think
events those events might be useless in this case.) So you might want to give
this a go, and see if the events you expect are really being generated. At the
moment, I'm rather assuming you won't see those events.<o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>If the source UI isn't generated the events you want, there's no way you
can force the events to appear. Whether events are generated is entirely up to
the source app or the framework that the UI's built in. Neither UIA nor your
client app can affect that. So it's then a case of figuring out whether there's
some workaround you can find, perhaps in the form of reacting to other events
that get generated in the particular scenario. So what I then did in this
situation is have AccEvent look for many more events, in case there's anything
that I can use. I just gave this a go, and found that I still not got useful
events.<o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>This makes things more complicated, as it looks like there are no useful
events being generated in the scroll scenarios. I know what I'm about to say
sounds ugly, but one way to account for this would be to use a low level
keyboard hook and mouse hook to detect certain key and mouse action. For
example, if after certain key presses, (eg arrows, page up/down, home/end), or
left mouse button down, assume that the UI shown on the screen might have
changed and after a slight delay to allow the UI to settle down, refresh your
own UI which sits on top of everything. Far from ideal, but sometimes if apps
you care about don't generate the events you want, you need some fairly brute
force workarounds.<o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>&nbsp;<o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan;mso-outline-level:1'><a
name="_Toc382133138"><b><span lang=EN-US style='font-size:24.0pt;font-family:
宋体;mso-bidi-font-family:宋体;mso-font-kerning:18.0pt'>A mix of perf and
inaccessible UI</span></b></a><b><span lang=EN-US style='font-size:24.0pt;
font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:18.0pt'><o:p></o:p></span></b></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><b><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>Q.</span></b><span lang=EN-US style='font-size:12.0pt;font-family:宋体;
mso-bidi-font-family:宋体;mso-font-kerning:0pt'> I was trying to work out the
best way of dealing with the situation:</span><span style='font-size:12.0pt;
font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:0pt'>我想处理一下情况<span
lang=EN-US><br>
&nbsp;<br>
1. The active window has no UIAutomation API</span>活动窗口没有<span lang=EN-US>UIAutomation
API<o:p></o:p></span></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>2. It simply takes too long to build the hierarchy of elements.</span><span
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>建立<span lang=EN-US>hierarchy of elements</span>时间太长<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>With the first option it's not too difficult because effectively I just
get an empty array of elements pretty quick when running ElementFromHandleBuildCache.<o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>However with the other scenario I'm not too sure how to abandon the cache
build after a specific amount of time other than using some pretty crude
devices. I also expect there will be some other applications where building the
element tree is not possible in a realistic amount of time.<o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>&nbsp;<o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><b><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>A.</span></b><span lang=EN-US style='font-size:12.0pt;font-family:宋体;
mso-bidi-font-family:宋体;mso-font-kerning:0pt'> When you say that the active
window has no UIA support, I assume that you can get a UIA element from the
main hwnd for the app? UIA should always provide you with that. But I expect
the problem is that various UI shown inside the hwnd doesn't seem to have UIA
elements associated with it. If so, what happens if you point the Inspect SDK
tool at the UI for which you're not getting UIA elements? If Inspect also can't
see it, maybe this is some custom UI and the people who built the UI didn't add
an accessibility support into it, (either in the form of UIA or MSAA.)<o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>I don't have a great solution for the UIA calls simply taking too long.
(On a side note, the Windows 8 UIA has some support for timing out long calls
into UIA. That was really added because if the target app has hung for good,
then a Windows 7 UIA call could block forever.)<o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>I expect you've already constrained your cache to be as slimmed-down at it
can be. Eg only requesting things that support the InvokePattern and are not
offscreen. It's possible that some apps are very slow to respond regardless of
what's in the cache requests.<o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>If you point Inspect to some of the slow apps you encounter, I wonder what
it typically reports. Eg is it because the UIA tree is really, really deep or
wide? Or maybe the tree is corrupt.<o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>&nbsp;<o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><b><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>Q.</span></b><span lang=EN-US style='font-size:12.0pt;font-family:宋体;
mso-bidi-font-family:宋体;mso-font-kerning:0pt'> Yes I can always get the main
window as a UIA element:<o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>rootWindow =
uia.ElementFromHandleBuildCache(Win32API.GetForegroundWindow(), myCache);<o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>&nbsp;<o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>I am already restricting it to invoke pattern elements that are visible
and when using Inspect it clearly shows the applications with no UIA support
(i.e. no elements are picked up on the UI) and using it with the particularly
slow app shows a fairly detailed element tree. I was more concerned with
applications that I don't have and haven't come across that users of my
application might come across and I was trying to find a generic way to timeout
if any sort of issue was hanging the cache build or making it take an
excessively long time.<o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>&nbsp;<o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><b><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>A.</span></b><span lang=EN-US style='font-size:12.0pt;font-family:宋体;
mso-bidi-font-family:宋体;mso-font-kerning:0pt'> For apps that support MSAA
rather than UIA natively, UIA uses its own &quot;MSAA Proxy&quot; to talk to
the app. The MSAA proxy takes the MSAA data provided by the app and converts it
as best it can to UIA data, and returns that to the UIA client. Converting
things like Name properties is straightforward, but converting the MSAA element
hierarchy to UIA such that the navigation calls work is pretty complicated.
Inspect will report what the provider is when you point it to an element, and
if you point it to Internet Explorer, you'll see &quot;MSAA Proxy&quot;.
Internet Explorer isn't a native UIA provider.<o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span style='font-size:12.0pt;
font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:0pt'>对于支持<span
lang=EN-US>msaa</span>而不是<span lang=EN-US>uia</span>的<span lang=EN-US>app</span>，<span
lang=EN-US>uia</span>提供了<span lang=EN-US>&quot;MSAA Proxy&quot;<o:p></o:p></span></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>So in general if the source app is either an MSAA or UIA provider, a
client can in theory get to the UI. But if the app has not included some piece
of the UI in the accessible element tree, there's really nothing UIA can do
about it. UIA's a channel through which an app can expose its UI to Assistive
Technology (AT) clients. In the past I've effectively been asked how a client
app can use UIA to make an inaccessible app accessible, (and the answer is - it
can't). In some cases if the client really wants to, it can make serious
assumptions about specific inaccessible apps, like where UI is relative to the
top left corner of the app window say. Eg I remember some popular app which
could occasionally slap some completely inaccessible UI in the middle of the
app window when it started. There's no way to programmatically invoke that UI
unless you assume that you know where it is. While doing this sort of thing is
undesirable, if a customer of yours relies on some inaccessible app, there may
be no alternative. (Obviously you know all this already, having built client
apps for so long.)<o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>&nbsp;</span><span style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:
宋体;mso-font-kerning:0pt'>所以如果<span lang=EN-US>app</span>是<span lang=EN-US>MSAA
or UIA provider</span>，客户理论上可以使用<span lang=EN-US>uia</span>的<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><b><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>Q.</span></b><span lang=EN-US style='font-size:12.0pt;font-family:宋体;
mso-bidi-font-family:宋体;mso-font-kerning:0pt'> After you mentioned the invoke
pattern and visible elements in your last email I actually went back through my
various property conditions that I had built the cache with and found that one
of the edit property conditions I had set wasn't restricted to on-screen or
enabled for that matter. That particular setting was causing much of the delay
with the slow app. Anyway at that point I decided to go back to scratch and
build the cache properties independently for each of the popular
applications/groups of application I would be using. My application now checks
the process name of the active window and uses an appropriate property
structure for each of the different applications/group of applications. When I
say appropriate I mean a set of properties which allow access as fast as I can
get it without missing out any elements. I started with a simple AND property
condition which was invoke pattern available, enabled and on-screen and took it
from there.<o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>As a simple example searching on those three conditions brings up pretty
much all of the elements with Shell based UI screens (Windows Explorer, programs
and features, control panel etc) but with the likes of Internet Explorer misses
out quite a few elements. Combo boxes, edit-based elements like search boxes
etc. Anyway I managed to get much more appropriate property searches for the
different groups of apps and have got pretty much instantaneous response on
most interfaces where Internet Explorer is probably the slowest but it's down
to something like 1.5 to 2 seconds maximum for the most complicated HTML pages
which is more than acceptable. With most webpages it is pretty instantaneous. I
can also build the cache on change of active window and a few other tricks to
speed up even more.<o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>I find it best to change the cache request properties with different
applications not only for quicker searches in some instances but to stop
duplicate rectangles on various items, particularly Internet Explorer. Quite
often as an example hyperlinks can have text control links as children leading
to small rectangles inside large rectangles duplicating functionality making
for a messy display. I could write methods to remove child rectangles inside
parent rectangles and other ancestors but it's easier just to set a particular
set of properties with different applications I find.<o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>A couple of other questions if I may as it will probably save me some time
when I start doing the clicking of rectangles. I can obviously invoke the
elements with invoke patterns but I also see there is the method
getClickablePoint () and I can also simply work out mouse coordinates from the
bounding rectangles. After a quick search I can’t actually see any way of doing
right clicks so I presume I can just use the Windows API mouse events for right
clicking using whatever method to find the best coordinates.<o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'><br>
&nbsp;<br>
<b>A.</b> You're right that UIA does not support telling an element to perform
its right-click action, (which often would result in a context menu appearing.)
I think the only way you can do this is to do exactly what you're considering.
Get a point which you feel lies over the element, and use SendInput() to
simulate a right click. Note that this could be more complicated if you're
presenting your own UI over the element at the time. If you have some area of
your own window that's not 100% transparent beneath the right click, your UI
will get the click, not the target window. For some reason I seem to feel that
not all UI does such a good job at implementing getClickablePoint as they do
the BoundingRect property. (But I don't remember why I think that, so I might
be wrong.) Some point inside the BoundingRect should be fine to click on, so
long at the element is rectangular.<o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>&nbsp;uia</span><span style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:
宋体;mso-font-kerning:0pt'>不支持右键操作，唯一可以做到的就是使用<span lang=EN-US>SendInput</span>来模仿右键<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><b><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>Response.</span></b><span lang=EN-US style='font-size:12.0pt;font-family:
宋体;mso-bidi-font-family:宋体;mso-font-kerning:0pt'> It seems to work fine with
either a midpoint on the bounding rectangle or using getClickablePoint ().
Interestingly getClickablePoint() adds a little bit of latency to creating the
window with the rectangles so I am going with the bounding rectangle midpoint.<o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>&nbsp;<o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan;mso-outline-level:1'><a
name="_Toc382133139"><b><span lang=EN-US style='font-size:24.0pt;font-family:
宋体;mso-bidi-font-family:宋体;mso-font-kerning:18.0pt'>Context Menus</span></b></a><b><span
lang=EN-US style='font-size:24.0pt;font-family:宋体;mso-bidi-font-family:宋体;
mso-font-kerning:18.0pt'><o:p></o:p></span></b></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><b><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>Q.</span></b><span lang=EN-US style='font-size:12.0pt;font-family:宋体;
mso-bidi-font-family:宋体;mso-font-kerning:0pt'> Guy have you dealt with UI
automation in terms of context menus and other menus for that matter? So as an
example if I was running Internet Explorer and opened the Favourites menu how
would I know it had been opened and how can I then show UI over the menu items?<o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>In fact most menus are accessible but for some reason with Internet
Explorer the menus, e.g. Favourites, seem to be descendants of the desktop
rather than the Internet explorer window.<o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>&nbsp;<o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><b><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>A.</span></b><span lang=EN-US style='font-size:12.0pt;font-family:宋体;
mso-bidi-font-family:宋体;mso-font-kerning:0pt'> I've just pointed the Inspect
SDK tool at an IE context menu, and as you say, its parent is the desktop
element. This isn't something you can influence, and so it's a case of working
with that UI as it is. I assume the issue here is that you're specifically
listening for events being raised by the foreground window or its descendant
elements, and in the case of the content window, those events aren't being
detected.<o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span style='font-size:12.0pt;
font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:0pt'>用<span lang=EN-US>Inspect</span>工具查看<span
lang=EN-US>IE context menu</span>，可以发现她的<span lang=EN-US>parent</span>是<span
lang=EN-US>desktop</span>。<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>As a test I ran the Accevent SDK tool. I went to the settings UI, and said
that I want to see events raised by the direct children, (not all descendants),
of the desktop element. And I only want to detect the MenuOpened event, (and no
other events). When I did that, and went to IE and right-clicked, I could see a
MenuOpened event. I could also see that the accessible name of the element
raising the event was &quot;Context&quot;. I then went back to the Accevent
tool, and changed the settings to report the process id of the element that
raised the event, and I could see that the process was one of the iexplore.exe
processes that I could see listed in Task Manager.<o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span style='font-size:12.0pt;
font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:0pt'>作为测试，运行<span
lang=EN-US>Accevent</span>。我检查<span lang=EN-US>desktop </span>的<span
lang=EN-US>MenuOpened<o:p></o:p></span></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>So if you want to be able to detect a context menu being opened while IE
is the app that the user's in, perhaps when you register for the events you're
listening to now, you also need to register for MenuOpened events from elements
which are direct children of the desktop element.&nbsp;<o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>I notice that when invoke the Favourites menu in IE, I didn't get the
MenuOpened event. But I did get a FocusChanged event, so maybe that would be
one way of detecting that the Favourites menu has been invoked.&nbsp;<o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>&nbsp;<o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan;mso-outline-level:1'><a
name="_Toc382133140"><b><span lang=EN-US style='font-size:24.0pt;font-family:
宋体;mso-bidi-font-family:宋体;mso-font-kerning:18.0pt'>Caching and properties</span></b></a><b><span
lang=EN-US style='font-size:24.0pt;font-family:宋体;mso-bidi-font-family:宋体;
mso-font-kerning:18.0pt'><o:p></o:p></span></b></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><b><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>Q.</span></b><span lang=EN-US style='font-size:12.0pt;font-family:宋体;
mso-bidi-font-family:宋体;mso-font-kerning:0pt'> Guy can you please explain the
following. If I set up my cache as shown below you will see that one of the
conditions included in the simplified overall condition (overallCondition) for
FindAllBuildCache () is a ClassNamePropertyID (nameMessagePanelCondition) and I
have not added those type of UIA_PropertyIds to the cache request yet it still
gives me a CachedBoundingRectangle for the element that meets the
nameMessagePanelCondition. I would have thought I would have had to include
ClassNamePropertyIDs to the cache request as in:<o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;color:navy;
mso-font-kerning:0pt'>myCache.AddProperty(UIA_PropertyIds.UIA_ClassNamePropertyId);</span><span
lang=EN-US style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;
mso-font-kerning:0pt'><o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>&nbsp;<o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>However I have not had to do this. Also any comments on this structure
generally as seen below. To simplify the question I am only using a tree item
condition and the class name condition in the overall condition.<o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;color:navy;
mso-font-kerning:0pt'>//create CacheRequest</span><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'><br>
<span style='color:navy'>myCache = uia.CreateCacheRequest();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><br>
<span style='color:navy'>myCache.AddProperty(UIA_PropertyIds.UIA_ControlTypePropertyId);</span><br>
<span style='color:navy'>myCache.AddProperty(UIA_PropertyIds.UIA_BoundingRectanglePropertyId);</span><o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;color:navy;
mso-font-kerning:0pt'>//all elements must be enabled and on screen</span><span
lang=EN-US style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;
mso-font-kerning:0pt'><br>
<span style='color:navy'>enabledCondition = uia.CreatePropertyCondition(UIA_PropertyIds.UIA_IsEnabledPropertyId,
true);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><br>
<span style='color:navy'>onScreenCondition =
uia.CreatePropertyCondition(UIA_PropertyIds.UIA_IsOffscreenPropertyId, false);</span><br>
<span style='color:navy'>enabledAndOnScreen = uia.CreateAndCondition(enabledCondition,
onScreenCondition);</span><o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;color:navy;
mso-font-kerning:0pt'>// Add a Property Condition which is a Control Type
Property, included in cache</span><span lang=EN-US style='font-size:12.0pt;
font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:0pt'><br>
<span style='color:navy'>treeItemCondition =
uia.CreatePropertyCondition(UIA_PropertyIds.UIA_ControlTypePropertyId,
UIA_ControlTypeIds.UIA_TreeItemControlTypeId);</span><o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;color:navy;
mso-font-kerning:0pt'>treeItemCondition =
uia.CreateAndCondition(treeItemCondition, enabledAndOnScreen);</span><span
lang=EN-US style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;
mso-font-kerning:0pt'><o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;color:navy;
mso-font-kerning:0pt'>// Add a Property Condition which is a Class Name
Property, NOT included in cache</span><span lang=EN-US style='font-size:12.0pt;
font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:0pt'><br>
<span style='color:navy'>//condition for Outlook 2007 message
panel&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;color:navy;
mso-font-kerning:0pt'>nameMessagePanelCondition = uia.CreatePropertyCondition(UIA_PropertyIds.UIA_ClassNamePropertyId,
&quot;SUPERGRID&quot;);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
lang=EN-US style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;
mso-font-kerning:0pt'><o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;color:navy;
mso-font-kerning:0pt'>// Create overall condition</span><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'><br>
<span style='color:navy'>overallCondition =
uia.CreateAndCondition(treeItemCondition,
nameMessageReadCondition);&nbsp;&nbsp;</span><o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;color:navy;
mso-font-kerning:0pt'>rootWindow =
uia.ElementFromHandleBuildCache(Win32API.GetForegroundWindow(), myCache);</span><span
lang=EN-US style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;
mso-font-kerning:0pt'><o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;color:navy;
mso-font-kerning:0pt'>//set scope of
cache&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:
宋体;mso-font-kerning:0pt'><br>
<span style='color:navy'>myCache.TreeScope = TreeScope.TreeScope_Element |
TreeScope.TreeScope_Children;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;color:navy;
mso-font-kerning:0pt'>//populate the element array</span><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'><br>
<span style='color:navy'>elementArray =
rootWindow.FindAllBuildCache(TreeScope.TreeScope_Descendants, overallCondition,
myCache);&nbsp;&nbsp;</span><o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;color:navy;
mso-font-kerning:0pt'>//so this piece of pseudocode is where i happens to be
the element that meets the nameMessageReadCondition</span><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'><o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;color:navy;
mso-font-kerning:0pt'>elementArray.GetElement
(i).CachedBoundingRectangle&nbsp;&nbsp; … This is still a valid cache
condition, how come??</span><span lang=EN-US style='font-size:12.0pt;
font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:0pt'><o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>&nbsp;<o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>Although the element array is built using FindAllBuildCache any element
from the array still gives me access to the &quot;current&quot; conditions as
shown below. So does this mean that all the current properties are populated
regardless of the element array being built with the CacheRequest?<o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>elementArray.GetElement (i).CurrentName&nbsp;&nbsp;<o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>&nbsp;<o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><b><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>A.</span></b><span lang=EN-US style='font-size:12.0pt;font-family:宋体;
mso-bidi-font-family:宋体;mso-font-kerning:0pt'> So as I read the code…<o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>The myCache object is set up for the ControlType and the BoundingRect.
This is used in two places later. The first is in the call to
ElementFromHandleBuildCache() to get the element for the foreground window. And
the second is in the call to FindAllBuildCache(), when certain descendants of
the foreground window element are accessed.<o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>Almost all the rest of the code relates to building up the condition to be
supplied to the FindAllBuildCache() call. The condition is that the element’s
enabled, not offscreen, a treeitem control, and has a “SUPERGRID” classname.<o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>You question is, why were the properties involved with the condition not
required to be set in the cache request? This is what I think the situation is…<o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>The condition and the cache are independent of each other. The condition
only relates to decisions around which elements are to be returned from the
function call. You could pass in your overall condition with no cache at all,
and still get the same elements back.<o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>The cache is used to allow faster access to the data you want to access
after you’ve made the call which got you the elements. Say some call to
FindAllBuildCache() got you 100 elements, and you then need the bounding rects
of all those elements. If you didn’t use a cache, you’d get the current
bounding rects for all the elements in turn, and that would mean you’d be
making 100 cross-process calls. Cross-process calls are slow, and so that hurts
the perf of your app. So you create a cache request for the bounding rects.
This means while UIA is gathering all the elements the FindAllBuildCache()
call, it’s also collecting all the bounding rects. It’s doing that during the
one cross-proc call where the elements are being collected, and so the work to
get the bounding rects results in no more cross-proc calls. Later when you get
the cache bounding rect element, it’s returning the cached value. Technically
that cache value might be stale, but often a client app would prefer to live
with that issue rather than incurring slow cross-proc calls.<o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>Now, your other question is also an interesting one. That is, how come the
CurrentName property works even though a cache request was used when getting
the elements? You’d set up a cache request for the ControlType and
BoundingRect, and that means you’re not making a cross-proc call when getting
those cached properties. But by default, UIA still allows you to get any
current property you want on the element. You can get the current name, or even
the current bounding rect, (not that you’d do that, given that it’s already
cached). But if you do get a current property, you’re incurring the perf hit of
a cross proc call, and only you can decide whether that’s acceptable. If you
think it’s pretty rare for you to want to get a current name, but once in a
while it happens, you could get the current name at that time. But if you feel
that it’s likely that you’ll need the current name for a few items, perhaps
you’d add the name property to your cache request.<o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>To get the current property, all you need is a full reference to the
element. (That is, a reference that still connects to some element in the
provider process.) The cache request contains something called AutomationElementMode.
By default that’s set to AutomationElementMode_Full, which means you get a full
reference. If you’d set the mode to AutomationElementMode_None in the cache
request, then all you get is a way to get the cached properties that you’d
requested. If you try to get current properties in that case, I’d expect the
calls to fail.<o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>By the way, the cache request itself also has a scope and condition. I
think this can get pretty confusing, and so wouldn't necessarily change your
code. If your code works, is understandable and maintainable, and perf is
acceptable, then that’s good. But technically I wonder if the following would
work…<o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>1. Set the cache’s TreeFilter to the overallCondition.<br>
2. Set the cache’s TreeScope to descendants.<br>
3. Make only one call to ElementFromHandleBuildCache().<br>
4. Call GetCachedChildren() to get the descendants that meet the condition.<br>
5. Access the cached properties from those children.<o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>I did something like this as an “alternate approach” at the end of
LinkProcess.cs up at <a
href="http://code.msdn.microsoft.com/Windows-7-UI-Automation-0625f55e/sourcecode?fileId=21468&amp;pathId=534397530">http://code.msdn.microsoft.com/Windows-7-UI-Automation-0625f55e/sourcecode?fileId=21468&amp;pathId=534397530</a>.
But like I say, there may be no real advantage for doing this over what you
already have, (and could have behaviours I don’t know about), so I’d stick with
whatever works.<o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>&nbsp;<o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan;mso-outline-level:1'><a
name="_Toc382133141"><b><span lang=EN-US style='font-size:24.0pt;font-family:
宋体;mso-bidi-font-family:宋体;mso-font-kerning:18.0pt'>Timeouts interacting with
unresponsive providers</span></b></a><b><span lang=EN-US style='font-size:24.0pt;
font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:18.0pt'><o:p></o:p></span></b></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><b><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>Q.</span></b><span lang=EN-US style='font-size:12.0pt;font-family:宋体;
mso-bidi-font-family:宋体;mso-font-kerning:0pt'> When I capture the elements on
the HTML document within a particular browser I am getting a 4 seconds delay
with some densely populated HTML pages but this only happens with Windows 7 and
not Windows 8 where it is virtually instant.&nbsp;<o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>&nbsp;<o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><b><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>A.</span></b><span lang=EN-US style='font-size:12.0pt;font-family:宋体;
mso-bidi-font-family:宋体;mso-font-kerning:0pt'> Regarding the difference in
performance of the UIA API between Windows 7 and Windows 8, one possible reason
for this relates to timeout functionality that was added to UIA in Windows 8.
In Windows 7, when you made a call to a UIA client API, the call could block
until the provider process finished responding to the call. So if the provider was
slow, then your client app might be unresponsive for a while. Worse, if the
provider hung permanently, then so might your client app. Obviously that's a
big problem for your customer.<o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>So in Windows 8, UIA was enhanced such that the client APIs automatically
have timeouts associated with them. The intent is that if a provider process
does not respond to some call within a certain time, then UIA will stop waiting
and return control to the client. In that case, the client API should return an
error code of UIA_E_TIMEOUT, but I don't know if that's always guaranteed.<o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>There are two timeout settings. The first relates to establishing contact
with a provider. A provider should be able to respond to this very quickly
indeed, and so if there's even a small delay in this happening, that suggests
that the provider is unresponsive. So the default timeout for that action is
only two seconds. The other timeout relates to gathering information from the
provider after contact with the provider has been established. Some operations
will involve processing many hundreds of UI elements, (and this is likely the
case in your situation when you're working with a browser), so it could take a
while for the provider to gather all the data that's being requested. So by
default the timeout for that action is 20 seconds.<o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>The client app can configure these timeouts. If the defaults aren't
optimized for the apps you're working with or the operations you do, the
properties you'd set for configuring the timeouts are IUIAutomation2::ConnectionTimeout
and IUIAutomation2::TransactionTimeout. (All the new functionality added for
Windows 8 is listed up at <a
href="http://msdn.microsoft.com/en-us/library/windows/desktop/hh437316%28v=VS.85%29.aspx">http://msdn.microsoft.com/en-us/library/windows/desktop/hh437316(v=VS.85).aspx</a>.)<o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>Now having said all that, sometimes the actual timeouts your client app
experiences may not be exactly 2 seconds or 20 seconds. Depending on the action
being performed, sometimes the timeouts can get compounded internally because
UIA might have to make multiple interactions with the provider beneath a single
call to a client API. That can result in the client experiencing a longer
timeout than the published default values.<o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>But despite there sometimes being some variation in the actual timeout
experienced, (and I believe it being possible for UIA_E_TIMEOUT to not be
returned after a timeout has occurred,) the addition of the timeout
functionality for the client APIs is a very important enhancement to UIA in
Windows 8. If a provider process is hung, the client app must be able to
continue to serve its customer.<o:p></o:p></span></p>

<p class=MsoNormal align=left style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;text-align:left;mso-pagination:widow-orphan'><span lang=EN-US
style='font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:
0pt'>I don't know if this can explain the differences you're seeing. I would
have thought it might be relevant if you'd seen your Windows 8 client API call
return after 2 seconds, but you've said that the call is virtually instant.
Also, if the timeout had occurred, I wouldn't have expected you to get all the
data you're after in that case. A timeout means that the provider didn’t supply
you with the data you need in a responsive manner. I'm assuming that you did
get the data you need. But I'm afraid I can’t really think of another reason
for this difference in behavior between Windows 7 and Windows 8.<o:p></o:p></span></p>

<p class=MsoPlainText><span lang=EN-US style='mso-hansi-font-family:宋体;
mso-bidi-font-family:宋体'><o:p>&nbsp;</o:p></span></p>

</div>

</body>

</html>
